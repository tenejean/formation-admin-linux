<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jour 45 - D√©pannage syst√®me Linux</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header .subtitle {
            color: #7f8c8d;
            font-size: 1.2em;
            font-weight: 300;
        }

        .content-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .content-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.15);
        }

        h2 {
            color: #2c3e50;
            font-size: 1.8em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
            position: relative;
        }

        h2::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 0;
            width: 50px;
            height: 3px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 2px;
        }

        h3 {
            color: #34495e;
            font-size: 1.4em;
            margin: 25px 0 15px 0;
            padding: 10px 0;
            border-left: 4px solid #667eea;
            padding-left: 15px;
            background: linear-gradient(90deg, rgba(102, 126, 234, 0.1), transparent);
        }

        p {
            margin-bottom: 15px;
            text-align: justify;
            color: #555;
        }

        .code-block {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            border-left: 5px solid #667eea;
            position: relative;
        }

        .code-block::before {
            content: 'üíª';
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 1.2em;
        }

        .command {
            color: #3498db;
            font-weight: bold;
        }

        .output {
            color: #2ecc71;
            margin-left: 20px;
        }

        .warning {
            background: linear-gradient(135deg, #ff9a56, #ff6b6b);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid #e74c3c;
            position: relative;
        }

        .warning::before {
            content: '‚ö†Ô∏è';
            position: absolute;
            top: 15px;
            left: -10px;
            background: white;
            border-radius: 50%;
            padding: 5px;
            font-size: 1.2em;
        }

        .info {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid #0984e3;
            position: relative;
        }

        .info::before {
            content: '‚ÑπÔ∏è';
            position: absolute;
            top: 15px;
            left: -10px;
            background: white;
            border-radius: 50%;
            padding: 5px;
            font-size: 1.2em;
        }

        .success {
            background: linear-gradient(135deg, #00b894, #00a085);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid #00a085;
            position: relative;
        }

        .success::before {
            content: '‚úÖ';
            position: absolute;
            top: 15px;
            left: -10px;
            background: white;
            border-radius: 50%;
            padding: 5px;
            font-size: 1.2em;
        }

        .checklist {
            background: linear-gradient(135deg, #a29bfe, #6c5ce7);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .checklist h4 {
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .checklist ul {
            list-style: none;
            padding-left: 0;
        }

        .checklist li {
            margin: 10px 0;
            padding: 8px 0;
            position: relative;
            padding-left: 30px;
        }

        .checklist li::before {
            content: '‚úì';
            position: absolute;
            left: 0;
            top: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .table-container {
            overflow-x: auto;
            margin: 20px 0;
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
        }

        th {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }

        tr:nth-child(even) {
            background: #f8f9fa;
        }

        tr:hover {
            background: #e3f2fd;
            transition: background 0.3s ease;
        }

        .footer {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            text-align: center;
            color: #7f8c8d;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .content-card {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîß Jour 45 - D√©pannage syst√®me Linux</h1>
            <p class="subtitle">Formation Administration Syst√®me Linux - Responsable: Jean Tene</p>
        </div>

        <div class="content-card">
            <h2>üéØ Objectifs du cours</h2>
            <p>√Ä la fin de cette session, vous serez capable de :</p>
            <ul style="margin-left: 20px; color: #555;">
                <li>Diagnostiquer les probl√®mes syst√®me courants sous Linux</li>
                <li>Utiliser les outils de diagnostic syst√®me</li>
                <li>Analyser les logs syst√®me pour identifier les probl√®mes</li>
                <li>R√©soudre les probl√®mes de performance</li>
                <li>D√©panner les probl√®mes de d√©marrage</li>
                <li>G√©rer les probl√®mes de m√©moire et d'espace disque</li>
            </ul>
        </div>

        <div class="content-card">
            <h2>üìã Introduction au d√©pannage syst√®me</h2>
            
            <h3>Qu'est-ce que le d√©pannage syst√®me ?</h3>
            <p>Le d√©pannage syst√®me est le processus d'identification, d'analyse et de r√©solution des probl√®mes qui affectent le fonctionnement normal d'un syst√®me Linux. Cela inclut les probl√®mes de performance, les erreurs syst√®me, les pannes de services, et les dysfonctionnements mat√©riels.</p>

            <h3>M√©thodologie de d√©pannage</h3>
            <div class="checklist">
                <h4>üîç Approche syst√©matique</h4>
                <ul>
                    <li>Identifier et d√©finir le probl√®me</li>
                    <li>Collecter les informations syst√®me</li>
                    <li>Analyser les sympt√¥mes</li>
                    <li>Formuler des hypoth√®ses</li>
                    <li>Tester les solutions</li>
                    <li>Documenter la r√©solution</li>
                </ul>
            </div>
        </div>

        <div class="content-card">
            <h2>üõ†Ô∏è Outils de diagnostic syst√®me</h2>

            <h3>Commandes de base pour le diagnostic</h3>
            
            <h4>Informations syst√®me g√©n√©rales</h4>
            <div class="code-block">
<span class="command"># Informations sur le syst√®me</span>
uname -a
<span class="output">Linux server 5.4.0-74-generic #83-Ubuntu SMP x86_64 GNU/Linux</span>

<span class="command"># Temps de fonctionnement et charge syst√®me</span>
uptime
<span class="output">12:34:56 up 5 days, 2:15, 3 users, load average: 0.52, 0.48, 0.51</span>

<span class="command"># Informations sur la distribution</span>
lsb_release -a
cat /etc/os-release
            </div>

            <h4>Surveillance des processus</h4>
            <div class="code-block">
<span class="command"># Processus en cours d'ex√©cution</span>
ps aux | head -10

<span class="command"># Surveillance en temps r√©el</span>
top
htop

<span class="command"># Processus par consommation m√©moire</span>
ps aux --sort=-%mem | head -10

<span class="command"># Processus par consommation CPU</span>
ps aux --sort=-%cpu | head -10
            </div>

            <h4>Utilisation des ressources</h4>
            <div class="code-block">
<span class="command"># Utilisation m√©moire</span>
free -h
<span class="output">              total        used        free      shared  buff/cache   available
Mem:           7.7G        2.1G        3.2G        245M        2.4G        5.1G
Swap:          2.0G          0B        2.0G</span>

<span class="command"># Utilisation disque</span>
df -h
<span class="output">Filesystem      Size  Used Avail Use% Mounted on
/dev/sda1        20G   12G  7.2G  63% /
/dev/sda2       100G   45G   50G  48% /home</span>

<span class="command"># Utilisation inodes</span>
df -i
            </div>
        </div>

        <div class="content-card">
            <h2>üìä Analyse des performances syst√®me</h2>

            <h3>Surveillance de la charge syst√®me</h3>
            <p>La charge syst√®me (load average) indique le nombre de processus en attente d'ex√©cution. Une charge √©lev√©e peut indiquer un probl√®me de performance.</p>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Charge syst√®me</th>
                            <th>√âtat</th>
                            <th>Action recommand√©e</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>&lt; nombre de CPU</td>
                            <td>Normal</td>
                            <td>Aucune action n√©cessaire</td>
                        </tr>
                        <tr>
                            <td>= nombre de CPU</td>
                            <td>Charg√©</td>
                            <td>Surveillance recommand√©e</td>
                        </tr>
                        <tr>
                            <td>&gt; nombre de CPU</td>
                            <td>Surcharg√©</td>
                            <td>Investigation n√©cessaire</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="code-block">
<span class="command"># Nombre de CPU logiques</span>
nproc
<span class="output">4</span>

<span class="command"># Informations d√©taill√©es CPU</span>
lscpu | grep -E "CPU\(s\)|Model name"

<span class="command"># Surveillance CPU en temps r√©el</span>
vmstat 1 10
<span class="output">procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----
 r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st
 1  0      0 3245672  65432 2456789    0    0    12    45  234  567 15  5 78  2  0</span>
            </div>

            <h3>Diagnostic des goulots d'√©tranglement</h3>
            
            <h4>CPU</h4>
            <div class="code-block">
<span class="command"># Utilisation CPU par processus</span>
pidstat -u 1 5

<span class="command"># Processus consommant le plus de CPU</span>
ps -eo pid,ppid,cmd,%mem,%cpu --sort=-%cpu | head -10

<span class="command"># Statistiques syst√®me d√©taill√©es</span>
sar -u 1 10
            </div>

            <h4>M√©moire</h4>
            <div class="code-block">
<span class="command"># Analyse m√©moire d√©taill√©e</span>
cat /proc/meminfo

<span class="command"># Processus consommant le plus de m√©moire</span>
ps -eo pid,ppid,cmd,%mem,%cpu --sort=-%mem | head -10

<span class="command"># Surveillance m√©moire</span>
vmstat -s
watch -n 1 'free -h'
            </div>

            <h4>Disque I/O</h4>
            <div class="code-block">
<span class="command"># Statistiques I/O par dispositif</span>
iostat -x 1 5

<span class="command"># Processus utilisant le plus d'I/O</span>
iotop

<span class="command"># Surveillance I/O en temps r√©el</span>
pidstat -d 1 5
            </div>
        </div>

        <div class="content-card">
            <h2>üìù Analyse des logs syst√®me</h2>

            <h3>Logs syst√®me principaux</h3>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Fichier log</th>
                            <th>Description</th>
                            <th>Utilisation</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>/var/log/syslog</td>
                            <td>Messages syst√®me g√©n√©raux</td>
                            <td>Diagnostic g√©n√©ral</td>
                        </tr>
                        <tr>
                            <td>/var/log/kern.log</td>
                            <td>Messages du noyau</td>
                            <td>Probl√®mes mat√©riels</td>
                        </tr>
                        <tr>
                            <td>/var/log/auth.log</td>
                            <td>Authentification</td>
                            <td>S√©curit√©, connexions</td>
                        </tr>
                        <tr>
                            <td>/var/log/dmesg</td>
                            <td>Messages de d√©marrage</td>
                            <td>Diagnostic mat√©riel</td>
                        </tr>
                        <tr>
                            <td>/var/log/messages</td>
                            <td>Messages syst√®me (CentOS/RHEL)</td>
                            <td>Diagnostic g√©n√©ral</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3>Commandes d'analyse des logs</h3>
            <div class="code-block">
<span class="command"># Derni√®res entr√©es syst√®me</span>
tail -f /var/log/syslog

<span class="command"># Recherche d'erreurs</span>
grep -i error /var/log/syslog | tail -20
grep -i fail /var/log/syslog | tail -20

<span class="command"># Messages du noyau</span>
dmesg | tail -20
dmesg | grep -i error

<span class="command"># Logs systemd (journalctl)</span>
journalctl -f
journalctl -u nom_service
journalctl --since "1 hour ago"
            </div>

            <h3>Analyse avec journalctl</h3>
            <div class="code-block">
<span class="command"># Logs par priorit√© (erreurs critiques)</span>
journalctl -p err

<span class="command"># Logs par p√©riode</span>
journalctl --since "2023-01-01" --until "2023-01-02"
journalctl --since "10 minutes ago"

<span class="command"># Logs par service</span>
journalctl -u ssh.service
journalctl -u apache2.service --since today

<span class="command"># Statistiques des logs</span>
journalctl --disk-usage
journalctl --list-boots
            </div>
        </div>

        <div class="content-card">
            <h2>üöÄ D√©pannage des probl√®mes de d√©marrage</h2>

            <h3>Modes de r√©cup√©ration</h3>
            
            <h4>Mode single-user (rescue)</h4>
            <div class="info">
                Le mode single-user permet d'acc√©der au syst√®me avec des privil√®ges root pour effectuer des r√©parations critiques.
            </div>

            <div class="code-block">
<span class="command"># D√©marrage en mode rescue depuis GRUB</span>
# Ajouter √† la ligne de commande du noyau :
single
# ou
systemd.unit=rescue.target

<span class="command"># Basculer vers le mode rescue</span>
systemctl rescue

<span class="command"># Revenir au mode normal</span>
systemctl default
            </div>

            <h4>Probl√®mes GRUB</h4>
            <div class="code-block">
<span class="command"># R√©installer GRUB</span>
grub-install /dev/sda
update-grub

<span class="command"># V√©rifier la configuration GRUB</span>
cat /boot/grub/grub.cfg | grep menuentry

<span class="command"># Mode de r√©cup√©ration GRUB</span>
# Depuis GRUB, √©diter l'entr√©e et ajouter :
init=/bin/bash
            </div>

            <h3>Diagnostic du syst√®me de fichiers</h3>
            <div class="code-block">
<span class="command"># V√©rification syst√®me de fichiers</span>
fsck /dev/sda1
fsck -y /dev/sda1  # R√©paration automatique

<span class="command"># V√©rification des partitions mont√©es</span>
mount | grep "^/"
cat /proc/mounts

<span class="command"># Montage en mode lecture seule</span>
mount -o remount,ro /
            </div>

            <div class="warning">
                ‚ö†Ô∏è Attention : Ne jamais ex√©cuter fsck sur un syst√®me de fichiers mont√© en √©criture. D√©monter d'abord ou remonter en lecture seule.
            </div>
        </div>

        <div class="content-card">
            <h2>üíæ Probl√®mes d'espace disque et m√©moire</h2>

            <h3>Diagnostic d'espace disque</h3>
            <div class="code-block">
<span class="command"># Utilisation par r√©pertoire</span>
du -sh /* 2>/dev/null | sort -hr

<span class="command"># Fichiers volumineux</span>
find / -type f -size +100M 2>/dev/null | head -10

<span class="command"># Inodes utilis√©s</span>
df -i
find / -xdev -type f | cut -d/ -f2 | sort | uniq -c | sort -nr

<span class="command"># Fichiers supprim√©s mais toujours ouverts</span>
lsof +L1
            </div>

            <h3>Nettoyage syst√®me</h3>
            <div class="code-block">
<span class="command"># Nettoyage des logs anciens</span>
journalctl --vacuum-time=30d
journalctl --vacuum-size=500M

<span class="command"># Nettoyage du cache apt (Ubuntu/Debian)</span>
apt-get clean
apt-get autoclean
apt-get autoremove

<span class="command"># Nettoyage fichiers temporaires</span>
find /tmp -type f -atime +7 -delete
find /var/tmp -type f -atime +30 -delete
            </div>

            <h3>Probl√®mes de m√©moire</h3>
            <div class="code-block">
<span class="command"># Diagnostic m√©moire</span>
free -h
cat /proc/meminfo | grep -E "MemTotal|MemFree|MemAvailable|Buffers|Cached"

<span class="command"># Processus utilisant le plus de m√©moire</span>
ps aux --sort=-%mem | head -10

<span class="command"># Diagnostic OOM (Out of Memory)</span>
dmesg | grep -i "killed process"
grep -i "out of memory" /var/log/syslog

<span class="command"># Surveillance swap</span>
swapon -s
cat /proc/swaps
            </div>

            <div class="warning">
                ‚ö†Ô∏è Un syst√®me qui utilise massivement le swap indique g√©n√©ralement un manque de RAM. Cela peut consid√©rablement ralentir les performances.
            </div>
        </div>

        <div class="content-card">
            <h2>‚öôÔ∏è D√©pannage des services</h2>

            <h3>Diagnostic des services systemd</h3>
            <div class="code-block">
<span class="command"># √âtat des services</span>
systemctl status nom_service
systemctl list-units --failed

<span class="command"># Logs d'un service</span>
journalctl -u nom_service
journalctl -u nom_service --since today -f

<span class="command"># Red√©marrage des services</span>
systemctl restart nom_service
systemctl reload nom_service

<span class="command"># D√©pendances des services</span>
systemctl list-dependencies nom_service
systemctl show nom_service
            </div>

            <h3>Probl√®mes de r√©seau</h3>
            <div class="code-block">
<span class="command"># Configuration r√©seau</span>
ip addr show
ip route show

<span class="command"># Test de connectivit√©</span>
ping -c 4 8.8.8.8
traceroute google.com

<span class="command"># Services r√©seau</span>
netstat -tulpn
ss -tulpn

<span class="command"># DNS</span>
nslookup google.com
dig google.com
cat /etc/resolv.conf
            </div>
        </div>

        <div class="content-card">
            <h2>üîß Outils avanc√©s de diagnostic</h2>

            <h3>Surveillance syst√®me avec sar</h3>
            <div class="code-block">
<span class="command"># Installation sysstat (si n√©cessaire)</span>
apt-get install sysstat  # Ubuntu/Debian
yum install sysstat      # CentOS/RHEL

<span class="command"># Statistiques CPU</span>
sar -u 1 10

<span class="command"># Statistiques m√©moire</span>
sar -r 1 10

<span class="command"># Statistiques I/O</span>
sar -b 1 10

<span class="command"># Historique quotidien</span>
sar -u -f /var/log/sysstat/saXX  # XX = jour du mois
            </div>

            <h3>Analyse avec strace</h3>
            <div class="code-block">
<span class="command"># Tracer un processus existant</span>
strace -p PID

<span class="command"># Tracer un nouveau processus</span>
strace -o trace.log commande

<span class="command"># Tracer les appels syst√®me sp√©cifiques</span>
strace -e open,read,write -p PID

<span class="command"># Statistiques des appels syst√®me</span>
strace -c -p PID
            </div>

            <h3>Diagnostic mat√©riel</h3>
            <div class="code-block">
<span class="command"># Informations mat√©riel</span>
lshw -short
lspci
lsusb

<span class="command"># √âtat des disques</span>
smartctl -a /dev/sda
hdparm -I /dev/sda

<span class="command"># Temp√©rature syst√®me</span>
sensors
cat /sys/class/thermal/thermal_zone*/temp

<span class="command"># Messages mat√©riels</span>
dmesg | grep -i -E "error|fail|warn"
            </div>
        </div>

        <div class="content-card">
            <h2>üìã Proc√©dures de d√©pannage courantes</h2>

            <div class="checklist">
                <h4>üîç Syst√®me lent</h4>
                <ul>
                    <li>V√©rifier la charge syst√®me avec <code>uptime</code> et <code>top</code></li>
                    <li>Analyser l'utilisation CPU avec <code>pidstat -u</code></li>
                    <li>Contr√¥ler la m√©moire avec <code>free -h</code> et identifier les processus gourmands</li>
                    <li>V√©rifier l'I/O disque avec <code>iostat -x</code></li>
                    <li>Examiner les logs avec <code>journalctl -p err</code></li>
                </ul>
            </div>

            <div class="checklist">
                <h4>üíæ Plus d'espace disque</h4>
                <ul>
                    <li>Identifier les r√©pertoires volumineux avec <code>du -sh /*</code></li>
                    <li>Trouver les gros fichiers avec <code>find / -size +100M</code></li>
                    <li>Nettoyer les logs anciens avec <code>journalctl --vacuum-time=30d</code></li>
                    <li>Supprimer les paquets inutiles avec <code>apt autoremove</code></li>
                    <li>V√©rifier les fichiers supprim√©s mais ouverts avec <code>lsof +L1</code></li>
                </ul>
            </div>

            <div class="checklist">
                <h4>üö´ Service ne d√©marre pas</h4>
                <ul>
                    <li>V√©rifier l'√©tat avec <code>systemctl status service</code></li>
                    <li>Consulter les logs avec <code>journalctl -u service</code></li>
                    <li>V√©rifier les d√©pendances avec <code>systemctl list-dependencies service</code></li>
                    <li>Tester la configuration avec <code>service --test-config</code> (si disponible)</li>
                    <li>V√©rifier les permissions des fichiers de configuration</li>
                    <li>Red√©marrer en mode debug si possible</li>
                </ul>
            </div>

            <div class="checklist">
                <h4>üîå Probl√®mes r√©seau</h4>
                <ul>
                    <li>V√©rifier la connectivit√© physique et la configuration IP</li>
                    <li>Tester la connectivit√© avec <code>ping</code> et <code>traceroute</code></li>
                    <li>Contr√¥ler les services r√©seau avec <code>systemctl status networking</code></li>
                    <li>V√©rifier les r√®gles firewall avec <code>iptables -L</code></li>
                    <li>Analyser les logs r√©seau dans <code>/var/log/syslog</code></li>
                </ul>
            </div>
        </div>

        <div class="content-card">
            <h2>üõ°Ô∏è Scripts de diagnostic automatis√©</h2>

            <h3>Script de diagnostic syst√®me</h3>
            <div class="code-block">
<span class="command">#!/bin/bash</span>
# Script de diagnostic syst√®me Linux

echo "=== DIAGNOSTIC SYST√àME ==="
echo "Date: $(date)"
echo "Hostname: $(hostname)"
echo "Uptime: $(uptime)"
echo

echo "=== INFORMATIONS SYST√àME ==="
uname -a
lsb_release -a 2>/dev/null
echo

echo "=== CHARGE SYST√àME ==="
echo "Load Average: $(cat /proc/loadavg)"
echo "CPU Count: $(nproc)"
echo

echo "=== M√âMOIRE ==="
free -h
echo

echo "=== ESPACE DISQUE ==="
df -h
echo

echo "=== PROCESSUS TOP CPU ==="
ps aux --sort=-%cpu | head -10
echo

echo "=== PROCESSUS TOP M√âMOIRE ==="
ps aux --sort=-%mem | head -10
echo

echo "=== SERVICES √âCHOU√âS ==="
systemctl list-units --failed --no-pager
echo

echo "=== DERNI√àRES ERREURS ==="
journalctl -p err --since "1 hour ago" --no-pager | tail -10
            </div>

            <h3>Script de surveillance des ressources</h3>
            <div class="code-block">
<span class="command">#!/bin/bash</span>
# Script de surveillance des ressources

THRESHOLD_CPU=80
THRESHOLD_MEM=90
THRESHOLD_DISK=85

# Fonction d'alerte
send_alert() {
    echo "ALERTE: $1" | logger -t system_monitor
    echo "ALERTE: $1"
}

# Surveillance CPU
CPU_USAGE=$(top -bn1 | grep "Cpu(s)" | awk '{print $2}' | cut -d'%' -f1)
if (( $(echo "$CPU_USAGE > $THRESHOLD_CPU" | bc -l) )); then
    send_alert "CPU usage high: ${CPU_USAGE}%"
fi

# Surveillance m√©moire
MEM_USAGE=$(free | grep Mem | awk '{printf "%.0f", $3/$2 * 100.0}')
if [ $MEM_USAGE -gt $THRESHOLD_MEM ]; then
    send_alert "Memory usage high: ${MEM_USAGE}%"
fi

# Surveillance disque
df -h | grep -vE '^Filesystem|tmpfs|cdrom' | awk '{print $5 " " $1}' | while read output;
do
    usage=$(echo $output | awk '{print $1}' | cut -d'%' -f1)
    partition=$(echo $output | awk '{print $2}')
    if [ $usage -ge $THRESHOLD_DISK ]; then
        send_alert "Disk usage high on $partition: ${usage}%"
    fi
done
            </div>
        </div>

        <div class="content-card">
            <h2>üìö Cas pratiques de d√©pannage</h2>

            <h3>Cas 1: Syst√®me tr√®s lent</h3>
            <div class="info">
                <strong>Sympt√¥mes:</strong> Le syst√®me r√©pond tr√®s lentement, les commandes prennent beaucoup de temps √† s'ex√©cuter.
            </div>

            <div class="code-block">
<span class="command"># 1. V√©rifier la charge syst√®me</span>
uptime
<span class="output">15:30:45 up 2 days, 4:20, 2 users, load average: 8.50, 7.80, 6.90</span>

<span class="command"># 2. Identifier les processus consommateurs</span>
top -c
ps aux --sort=-%cpu | head -10

<span class="command"># 3. V√©rifier la m√©moire</span>
free -h
<span class="output">              total        used        free      shared  buff/cache   available
Mem:           7.7G        7.5G        100M        245M        150M        50M</span>

<span class="command"># 4. Analyser l'I/O</span>
iostat -x 1 5
iotop

<span class="command"># 5. V√©rifier les logs</span>
journalctl -p err --since "1 hour ago"
            </div>

            <div class="success">
                <strong>Solution:</strong> Dans ce cas, la charge √©lev√©e et l'utilisation m√©moire critique indiquent un probl√®me de ressources. Actions : identifier et arr√™ter les processus gourmands, ajouter de la m√©moire ou du swap, optimiser les applications.
            </div>

            <h3>Cas 2: Espace disque satur√©</h3>
            <div class="info">
                <strong>Sympt√¥mes:</strong> Messages d'erreur "No space left on device", impossibilit√© d'√©crire des fichiers.
            </div>

            <div class="code-block">
<span class="command"># 1. V√©rifier l'espace disque</span>
df -h
<span class="output">Filesystem      Size  Used Avail Use% Mounted on
/dev/sda1        20G   20G     0B 100% /</span>

<span class="command"># 2. Identifier les gros r√©pertoires</span>
du -sh /* 2>/dev/null | sort -hr | head -10

<span class="command"># 3. Trouver les gros fichiers</span>
find / -type f -size +100M 2>/dev/null | head -20

<span class="command"># 4. V√©rifier les inodes</span>
df -i

<span class="command"># 5. Fichiers supprim√©s mais ouverts</span>
lsof +L1
            </div>

            <div class="success">
                <strong>Solution:</strong> Nettoyer les logs anciens, supprimer les fichiers temporaires, identifier et supprimer les gros fichiers inutiles, red√©marrer les services qui retiennent des fichiers supprim√©s.
            </div>

            <h3>Cas 3: Service ne d√©marre pas</h3>
            <div class="info">
                <strong>Sympt√¥mes:</strong> Un service critique (Apache, MySQL, SSH) refuse de d√©marrer.
            </div>

            <div class="code-block">
<span class="command"># 1. V√©rifier l'√©tat du service</span>
systemctl status apache2
<span class="output">‚óè apache2.service - The Apache HTTP Server
   Loaded: loaded (/lib/systemd/system/apache2.service; enabled; vendor preset: enabled)
   Active: failed (Result: exit-code) since Mon 2023-06-15 15:30:00 UTC; 2min ago</span>

<span class="command"># 2. Consulter les logs d√©taill√©s</span>
journalctl -u apache2 --since today
systemctl status apache2 -l

<span class="command"># 3. Tester la configuration</span>
apache2ctl configtest
nginx -t  # pour nginx

<span class="command"># 4. V√©rifier les ports</span>
netstat -tulpn | grep :80
ss -tulpn | grep :80

<span class="command"># 5. V√©rifier les permissions</span>
ls -la /etc/apache2/
ls -la /var/log/apache2/
            </div>

            <div class="success">
                <strong>Solution:</strong> Corriger la configuration (erreur de syntaxe), lib√©rer le port occup√©, ajuster les permissions, v√©rifier les d√©pendances du service.
            </div>
        </div>

        <div class="content-card">
            <h2>üîß Outils de d√©pannage sp√©cialis√©s</h2>

            <h3>Diagnostic r√©seau avanc√©</h3>
            <div class="code-block">
<span class="command"># Tcpdump - capture de paquets</span>
tcpdump -i eth0 -n host 192.168.1.1
tcpdump -i any port 80 -w capture.pcap

<span class="command"># Wireshark en ligne de commande</span>
tshark -i eth0 -f "host 192.168.1.1"

<span class="command"># Analyse des connexions</span>
netstat -i  # Statistiques interfaces
netstat -r  # Table de routage
ss -s       # Statistiques sockets

<span class="command"># Test de bande passante</span>
iperf3 -s  # Serveur
iperf3 -c server_ip  # Client
            </div>

            <h3>Diagnostic mat√©riel</h3>
            <div class="code-block">
<span class="command"># Test m√©moire (n√©cessite red√©marrage)</span>
# Ajouter √† GRUB: memtest86+

<span class="command"># Diagnostic disque dur</span>
smartctl -a /dev/sda
badblocks -v /dev/sda

<span class="command"># Test de stress syst√®me</span>
stress --cpu 4 --timeout 60s
stress --vm 2 --vm-bytes 1G --timeout 60s

<span class="command"># Surveillance temp√©rature</span>
watch -n 1 sensors
cat /sys/class/thermal/thermal_zone*/temp
            </div>

            <h3>Outils de profilage</h3>
            <div class="code-block">
<span class="command"># Perf - profilage syst√®me</span>
perf top
perf record -g ./application
perf report

<span class="command"># Valgrind - d√©tection fuites m√©moire</span>
valgrind --leak-check=full ./application

<span class="command"># Ltrace - tra√ßage biblioth√®ques</span>
ltrace -p PID
ltrace ./application
            </div>
        </div>

        <div class="content-card">
            <h2>üìã Bonnes pratiques de d√©pannage</h2>

            <div class="checklist">
                <h4>üéØ M√©thodologie</h4>
                <ul>
                    <li>Toujours sauvegarder avant de modifier la configuration</li>
                    <li>Documenter chaque √©tape de d√©pannage</li>
                    <li>Tester une seule modification √† la fois</li>
                    <li>V√©rifier les logs avant et apr√®s chaque action</li>
                    <li>Avoir un plan de retour en arri√®re (rollback)</li>
                </ul>
            </div>

            <div class="checklist">
                <h4>üîç Investigation</h4>
                <ul>
                    <li>Reproduire le probl√®me de mani√®re fiable</li>
                    <li>Collecter le maximum d'informations syst√®me</li>
                    <li>Identifier les changements r√©cents</li>
                    <li>Consulter la documentation et les bases de connaissances</li>
                    <li>Impliquer les utilisateurs dans l'analyse des sympt√¥mes</li>
                </ul>
            </div>

            <div class="checklist">
                <h4>üõ°Ô∏è Pr√©vention</h4>
                <ul>
                    <li>Mettre en place une surveillance proactive</li>
                    <li>Effectuer une maintenance pr√©ventive r√©guli√®re</li>
                    <li>Maintenir une documentation syst√®me √† jour</li>
                    <li>Tester r√©guli√®rement les proc√©dures de r√©cup√©ration</li>
                    <li>Former l'√©quipe aux proc√©dures de d√©pannage</li>
                </ul>
            </div>
        </div>

        <div class="content-card">
            <h2>üí° Exercices pratiques</h2>

            <h3>Exercice 1: Diagnostic de performance</h3>
            <div class="info">
                <strong>Objectif:</strong> Analyser les performances d'un syst√®me et identifier les goulots d'√©tranglement.
            </div>
            
            <div class="checklist">
                <h4>üîß T√¢ches √† r√©aliser</h4>
                <ul>
                    <li>Utiliser <code>top</code>, <code>htop</code>, et <code>iostat</code> pour surveiller le syst√®me</li>
                    <li>Identifier les processus consommant le plus de ressources</li>
                    <li>Analyser l'utilisation m√©moire et swap</li>
                    <li>Cr√©er un rapport de performance avec recommandations</li>
                </ul>
            </div>

            <h3>Exercice 2: Simulation de panne</h3>
            <div class="info">
                <strong>Objectif:</strong> Simuler des pannes courantes et appliquer les proc√©dures de d√©pannage.
            </div>

            <div class="code-block">
<span class="command"># Simuler un remplissage de disque</span>
dd if=/dev/zero of=/tmp/bigfile bs=1M count=1000

<span class="command"># Simuler une charge CPU √©lev√©e</span>
stress --cpu $(nproc) --timeout 300s

<span class="command"># Simuler un probl√®me de service</span>
systemctl stop apache2
# Puis diagnostiquer et r√©soudre
            </div>

            <h3>Exercice 3: Analyse de logs</h3>
            <div class="info">
                <strong>Objectif:</strong> Analyser les logs syst√®me pour identifier des probl√®mes sp√©cifiques.
            </div>

            <div class="code-block">
<span class="command"># Rechercher des patterns d'erreur</span>
grep -i "error\|fail\|critical" /var/log/syslog | tail -20

<span class="command"># Analyser les tentatives de connexion</span>
grep "Failed password" /var/log/auth.log | awk '{print $11}' | sort | uniq -c | sort -nr

<span class="command"># Identifier les red√©marrages syst√®me</span>
last reboot | head -10
            </div>
        </div>

        <div class="content-card">
            <h2>üìñ Ressources et documentation</h2>

            <h3>Commandes de r√©f√©rence rapide</h3>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Cat√©gorie</th>
                            <th>Commande</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td rowspan="3">Syst√®me</td>
                            <td><code>uptime</code></td>
                            <td>Charge syst√®me et temps de fonctionnement</td>
                        </tr>
                        <tr>
                            <td><code>free -h</code></td>
                            <td>Utilisation m√©moire</td>
                        </tr>
                        <tr>
                            <td><code>df -h</code></td>
                            <td>Espace disque</td>
                        </tr>
                        <tr>
                            <td rowspan="3">Processus</td>
                            <td><code>top</code></td>
                            <td>Processus en temps r√©el</td>
                        </tr>
                        <tr>
                            <td><code>ps aux</code></td>
                            <td>Liste des processus</td>
                        </tr>
                        <tr>
                            <td><code>pidstat</code></td>
                            <td>Statistiques processus</td>
                        </tr>
                        <tr>
                            <td rowspan="3">Logs</td>
                            <td><code>journalctl</code></td>
                            <td>Logs systemd</td>
                        </tr>
                        <tr>
                            <td><code>dmesg</code></td>
                            <td>Messages noyau</td>
                        </tr>
                        <tr>
                            <td><code>tail -f /var/log/syslog</code></td>
                            <td>Suivi logs en temps r√©el</td>
                        </tr>
                        <tr>
                            <td rowspan="3">R√©seau</td>
                            <td><code>netstat -tulpn</code></td>
                            <td>Ports et connexions</td>
                        </tr>
                        <tr>
                            <td><code>ss -tulpn</code></td>
                            <td>Sockets syst√®me</td>
                        </tr>
                        <tr>
                            <td><code>tcpdump</code></td>
                            <td>Capture paquets r√©seau</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3>Fichiers de configuration importants</h3>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Fichier</th>
                            <th>Description</th>
                            <th>Usage</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>/etc/fstab</code></td>
                            <td>Montage des syst√®mes de fichiers</td>
                            <td>Probl√®mes de d√©marrage</td>
                        </tr>
                        <tr>
                            <td><code>/etc/hosts</code></td>
                            <td>R√©solution DNS locale</td>
                            <td>Probl√®mes r√©seau</td>
                        </tr>
                        <tr>
                            <td><code>/etc/resolv.conf</code></td>
                            <td>Configuration DNS</td>
                            <td>R√©solution de noms</td>
                        </tr>
                        <tr>
                            <td><code>/etc/systemd/system/</code></td>
                            <td>Services systemd</td>
                            <td>Gestion des services</td>
                        </tr>
                        <tr>
                            <td><code>/proc/</code></td>
                            <td>Informations syst√®me virtuelles</td>
                            <td>Diagnostic syst√®me</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="content-card">
            <h2>‚úÖ R√©sum√© et points cl√©s</h2>
            
            <div class="success">
                <h4>üéØ Objectifs atteints</h4>
                <p>Vous ma√Ætrisez maintenant :</p>
                <ul style="margin-left: 20px; margin-top: 10px;">
                    <li>Les m√©thodologies de d√©pannage syst√®me</li>
                    <li>Les outils de diagnostic et de surveillance</li>
                    <li>L'analyse des logs et des performances</li>
                    <li>La r√©solution des probl√®mes courants</li>
                    <li>Les bonnes pratiques de d√©pannage</li>
                </ul>
            </div>

            <div class="checklist">
                <h4>üîë Points cl√©s √† retenir</h4>
                <ul>
                    <li>Approche m√©thodique : identifier, analyser, tester, documenter</li>
                    <li>Les logs sont votre meilleur alli√© pour le diagnostic</li>
                    <li>Surveiller les ressources syst√®me en permanence</li>
                    <li>Toujours sauvegarder avant de modifier</li>
                    <li>Documenter les proc√©dures de r√©solution</li>
                    <li>La pr√©vention vaut mieux que la r√©paration</li>
                </ul>
            </div>

            <div class="info">
                <strong>Prochaine √©tape:</strong> Le Jour 46 couvrira le "D√©pannage r√©seau" o√π nous approfondirons les techniques de diagnostic et de r√©solution des probl√®mes r√©seau sp√©cifiques.
            </div>
        </div>

        <div class="footer">
            <p>üìö Formation Administration Syst√®me Linux - Jour 45</p>
            <p>Responsable: Jean Tene | Cr√©√© avec passion pour l'apprentissage üöÄ</p>
        </div>
    </div>
</body>
</html>