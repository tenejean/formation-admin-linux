<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formation Linux - Jour 23 : Sauvegarde et restauration</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            min-height: 100vh;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.1);
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 2rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="2" fill="rgba(255,255,255,0.1)"/><circle cx="80" cy="80" r="2" fill="rgba(255,255,255,0.1)"/><circle cx="40" cy="60" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="70" cy="30" r="1.5" fill="rgba(255,255,255,0.1)"/></svg>');
            animation: float 20s infinite ease-in-out;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            position: relative;
            z-index: 1;
        }
        
        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }
        
        .content {
            padding: 2rem;
        }
        
        .section {
            margin-bottom: 3rem;
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            border-left: 5px solid #3498db;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .section:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .section h2 {
            color: #2c3e50;
            font-size: 1.8rem;
            margin-bottom: 1rem;
            border-bottom: 3px solid #3498db;
            padding-bottom: 0.5rem;
            display: flex;
            align-items: center;
        }
        
        .section h2::before {
            content: 'üìÇ';
            margin-right: 0.5rem;
            font-size: 1.5rem;
        }
        
        .section h3 {
            color: #34495e;
            font-size: 1.4rem;
            margin: 1.5rem 0 1rem 0;
            position: relative;
            padding-left: 1rem;
        }
        
        .section h3::before {
            content: '‚ñ∂';
            position: absolute;
            left: 0;
            color: #3498db;
        }
        
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 1.5rem;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            margin: 1rem 0;
            overflow-x: auto;
            position: relative;
            border: 1px solid #4a5568;
        }
        
        .code-block::before {
            content: 'Terminal';
            position: absolute;
            top: 0;
            right: 0;
            background: #3498db;
            color: white;
            padding: 0.25rem 0.75rem;
            font-size: 0.8rem;
            border-radius: 0 10px 0 10px;
        }
        
        .command {
            color: #68d391;
            font-weight: bold;
        }
        
        .warning {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            border: 1px solid #ffc107;
            border-radius: 10px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 5px solid #ffc107;
        }
        
        .warning::before {
            content: '‚ö†Ô∏è ';
            font-weight: bold;
        }
        
        .info {
            background: linear-gradient(135deg, #d1ecf1, #b8e6ff);
            border: 1px solid #17a2b8;
            border-radius: 10px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 5px solid #17a2b8;
        }
        
        .info::before {
            content: '‚ÑπÔ∏è ';
            font-weight: bold;
        }
        
        .success {
            background: linear-gradient(135deg, #d4edda, #c8e6c9);
            border: 1px solid #28a745;
            border-radius: 10px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 5px solid #28a745;
        }
        
        .success::before {
            content: '‚úÖ ';
            font-weight: bold;
        }
        
        .table-container {
            overflow-x: auto;
            margin: 1rem 0;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        th, td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }
        
        th {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            font-weight: bold;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .nav-menu {
            background: #34495e;
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .nav-menu ul {
            list-style: none;
            display: flex;
            flex-wrap: wrap;
            gap: 2rem;
        }
        
        .nav-menu a {
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            transition: background 0.3s ease;
        }
        
        .nav-menu a:hover {
            background: #3498db;
        }
        
        .footer {
            background: #2c3e50;
            color: white;
            text-align: center;
            padding: 2rem;
            margin-top: 3rem;
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .content {
                padding: 1rem;
            }
            
            .section {
                padding: 1rem;
            }
            
            .nav-menu ul {
                flex-direction: column;
                gap: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>Formation Linux - Jour 23</h1>
            <p>Sauvegarde et restauration</p>
        </header>
        
        <nav class="nav-menu">
            <ul>
                <li><a href="#introduction">Introduction</a></li>
                <li><a href="#types">Types de sauvegarde</a></li>
                <li><a href="#outils">Outils</a></li>
                <li><a href="#strategies">Strat√©gies</a></li>
                <li><a href="#pratique">Pratique</a></li>
                <li><a href="#automatisation">Automatisation</a></li>
            </ul>
        </nav>
        
        <main class="content">
            <section id="introduction" class="section">
                <h2>Introduction √† la sauvegarde</h2>
                
                <p>La sauvegarde et la restauration constituent l'un des aspects les plus critiques de l'administration syst√®me. Une strat√©gie de sauvegarde bien con√ßue peut faire la diff√©rence entre une simple interruption de service et une perte catastrophique de donn√©es.</p>
                
                <h3>Pourquoi sauvegarder ?</h3>
                <ul style="margin-left: 2rem; margin-top: 1rem;">
                    <li><strong>Protection contre les pannes mat√©rielles</strong> : Disques durs, contr√¥leurs RAID, alimentations</li>
                    <li><strong>Erreurs humaines</strong> : Suppressions accidentelles, modifications incorrectes</li>
                    <li><strong>Corruption de donn√©es</strong> : Bugs logiciels, interruptions de courant</li>
                    <li><strong>Attaques malveillantes</strong> : Ransomware, intrusions, sabotage</li>
                    <li><strong>Catastrophes naturelles</strong> : Incendies, inondations, tremblements de terre</li>
                </ul>
                
                <div class="warning">
                    <strong>R√®gle d'or :</strong> "Ce n'est pas une question de SI vos donn√©es seront perdues, mais QUAND elles le seront."
                </div>
            </section>
            
            <section id="types" class="section">
                <h2>Types de sauvegarde</h2>
                
                <h3>Sauvegarde compl√®te (Full Backup)</h3>
                <p>Copie int√©grale de toutes les donn√©es s√©lectionn√©es √† un moment donn√©.</p>
                
                <div class="success">
                    <strong>Avantages :</strong>
                    <ul style="margin-top: 0.5rem;">
                        <li>Restauration simple et rapide</li>
                        <li>Une seule archive n√©cessaire</li>
                        <li>Aucune d√©pendance sur d'autres sauvegardes</li>
                    </ul>
                </div>
                
                <div class="warning">
                    <strong>Inconv√©nients :</strong>
                    <ul style="margin-top: 0.5rem;">
                        <li>Temps de sauvegarde long</li>
                        <li>Espace de stockage important</li>
                        <li>Bande passante r√©seau √©lev√©e</li>
                    </ul>
                </div>
                
                <h3>Sauvegarde incr√©mentale</h3>
                <p>Ne sauvegarde que les fichiers modifi√©s depuis la derni√®re sauvegarde (compl√®te ou incr√©mentale).</p>
                
                <div class="code-block">
<span class="command">Exemple de s√©quence :</span>
Dimanche : Sauvegarde compl√®te
Lundi : Incr√©mentale (changements depuis dimanche)
Mardi : Incr√©mentale (changements depuis lundi)
Mercredi : Incr√©mentale (changements depuis mardi)
...
                </div>
                
                <h3>Sauvegarde diff√©rentielle</h3>
                <p>Sauvegarde tous les fichiers modifi√©s depuis la derni√®re sauvegarde compl√®te.</p>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Type</th>
                                <th>Temps de sauvegarde</th>
                                <th>Espace requis</th>
                                <th>Temps de restauration</th>
                                <th>Complexit√©</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Compl√®te</td>
                                <td>Long</td>
                                <td>Maximum</td>
                                <td>Rapide</td>
                                <td>Simple</td>
                            </tr>
                            <tr>
                                <td>Incr√©mentale</td>
                                <td>Rapide</td>
                                <td>Minimum</td>
                                <td>Long</td>
                                <td>Complexe</td>
                            </tr>
                            <tr>
                                <td>Diff√©rentielle</td>
                                <td>Moyen</td>
                                <td>Moyen</td>
                                <td>Moyen</td>
                                <td>Mod√©r√©e</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>
            
            <section id="outils" class="section">
                <h2>Outils de sauvegarde sous Linux</h2>
                
                <h3>tar (Tape Archive)</h3>
                <p>L'outil de base pour cr√©er des archives sous Linux.</p>
                
                <div class="code-block">
<span class="command"># Cr√©er une archive</span>
tar -czf sauvegarde_$(date +%Y%m%d).tar.gz /home /etc /var/log

<span class="command"># Lister le contenu</span>
tar -tzf sauvegarde_20250616.tar.gz

<span class="command"># Extraire l'archive</span>
tar -xzf sauvegarde_20250616.tar.gz

<span class="command"># Extraire un fichier sp√©cifique</span>
tar -xzf sauvegarde_20250616.tar.gz etc/passwd
                </div>
                
                <div class="info">
                    <strong>Options importantes :</strong><br>
                    -c : cr√©er, -x : extraire, -t : lister<br>
                    -z : compression gzip, -j : compression bzip2, -J : compression xz<br>
                    -v : verbose, -f : fichier
                </div>
                
                <h3>rsync</h3>
                <p>Outil de synchronisation et de sauvegarde incr√©mentale tr√®s efficace.</p>
                
                <div class="code-block">
<span class="command"># Synchronisation locale</span>
rsync -av /home/utilisateur/ /backup/home/

<span class="command"># Synchronisation distante</span>
rsync -av -e ssh /home/data/ user@serveur:/backup/data/

<span class="command"># Avec exclusions</span>
rsync -av --exclude='*.tmp' --exclude='cache/' /home/ /backup/

<span class="command"># Mode dry-run (simulation)</span>
rsync -av --dry-run /source/ /destination/
                </div>
                
                <h3>dd (Data Duplicator)</h3>
                <p>Outil de bas niveau pour copier des blocs de donn√©es.</p>
                
                <div class="code-block">
<span class="command"># Sauvegarder un disque entier</span>
dd if=/dev/sda of=/backup/disk_sda.img bs=4M status=progress

<span class="command"># Sauvegarder le MBR</span>
dd if=/dev/sda of=/backup/mbr.img bs=512 count=1

<span class="command"># Restaurer une image</span>
dd if=/backup/disk_sda.img of=/dev/sdb bs=4M status=progress
                </div>
                
                <div class="warning">
                    <strong>Attention :</strong> dd est un outil puissant mais dangereux. Une erreur dans les param√®tres if/of peut d√©truire vos donn√©es !
                </div>
                
                <h3>Bacula</h3>
                <p>Solution de sauvegarde d'entreprise open source avec architecture client-serveur.</p>
                
                <h3>Amanda</h3>
                <p>Advanced Maryland Automatic Network Disk Archiver - solution de sauvegarde r√©seau.</p>
                
                <h3>Duplicity</h3>
                <p>Outil de sauvegarde chiffr√©e avec support des services cloud.</p>
                
                <div class="code-block">
<span class="command"># Sauvegarde chiffr√©e vers un serveur FTP</span>
duplicity /home ftp://user@server/backup

<span class="command"># Sauvegarde vers Amazon S3</span>
duplicity /home s3://bucket-name/backup
                </div>
            </section>
            
            <section id="strategies" class="section">
                <h2>Strat√©gies de sauvegarde</h2>
                
                <h3>R√®gle 3-2-1</h3>
                <div class="success">
                    <strong>3</strong> copies de vos donn√©es importantes<br>
                    <strong>2</strong> supports de stockage diff√©rents<br>
                    <strong>1</strong> copie hors site (offsite)
                </div>
                
                <h3>Planification des sauvegardes</h3>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Fr√©quence</th>
                                <th>Type</th>
                                <th>R√©tention</th>
                                <th>Usage</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Quotidienne</td>
                                <td>Incr√©mentale</td>
                                <td>1 mois</td>
                                <td>R√©cup√©ration rapide</td>
                            </tr>
                            <tr>
                                <td>Hebdomadaire</td>
                                <td>Diff√©rentielle</td>
                                <td>3 mois</td>
                                <td>R√©cup√©ration interm√©diaire</td>
                            </tr>
                            <tr>
                                <td>Mensuelle</td>
                                <td>Compl√®te</td>
                                <td>12 mois</td>
                                <td>Archive long terme</td>
                            </tr>
                            <tr>
                                <td>Annuelle</td>
                                <td>Compl√®te</td>
                                <td>7 ans</td>
                                <td>Archive l√©gale</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <h3>Supports de stockage</h3>
                
                <ul style="margin-left: 2rem; margin-top: 1rem;">
                    <li><strong>Disques durs externes</strong> : Rapides, capacit√© √©lev√©e, co√ªt mod√©r√©</li>
                    <li><strong>Bandes magn√©tiques</strong> : Tr√®s haute capacit√©, co√ªt par GB faible, acc√®s s√©quentiel</li>
                    <li><strong>Stockage cloud</strong> : Accessible partout, g√©r√© par le provider, co√ªt r√©current</li>
                    <li><strong>NAS/SAN</strong> : Acc√®s r√©seau, RAID int√©gr√©, partage multi-utilisateurs</li>
                </ul>
                
                <h3>Emplacement des sauvegardes</h3>
                
                <div class="info">
                    <strong>Sur site (onsite) :</strong> Acc√®s rapide, contr√¥le total, risque de perte simultan√©e<br>
                    <strong>Hors site (offsite) :</strong> Protection contre les catastrophes, acc√®s plus lent, co√ªts de transport
                </div>
            </section>
            
            <section id="pratique" class="section">
                <h2>Travaux pratiques</h2>
                
                <h3>TP 1 : Sauvegarde avec tar</h3>
                
                <div class="code-block">
<span class="command"># 1. Cr√©er des donn√©es de test</span>
mkdir -p /tmp/test_backup
echo "Fichier important" > /tmp/test_backup/important.txt
echo "Configuration" > /tmp/test_backup/config.conf
mkdir /tmp/test_backup/dossier
echo "Sous-fichier" > /tmp/test_backup/dossier/subfichier.txt

<span class="command"># 2. Cr√©er une sauvegarde compl√®te</span>
tar -czf /tmp/backup_$(date +%Y%m%d_%H%M%S).tar.gz /tmp/test_backup

<span class="command"># 3. V√©rifier le contenu</span>
tar -tzf /tmp/backup_*.tar.gz

<span class="command"># 4. Simuler une perte de donn√©es</span>
rm -rf /tmp/test_backup

<span class="command"># 5. Restaurer depuis la sauvegarde</span>
cd /
tar -xzf /tmp/backup_*.tar.gz
                </div>
                
                <h3>TP 2 : Synchronisation avec rsync</h3>
                
                <div class="code-block">
<span class="command"># 1. Cr√©er la structure source</span>
mkdir -p /tmp/source/{docs,images,scripts}
echo "Document 1" > /tmp/source/docs/doc1.txt
echo "Document 2" > /tmp/source/docs/doc2.txt
echo "Script bash" > /tmp/source/scripts/script.sh

<span class="command"># 2. Premi√®re synchronisation</span>
rsync -av /tmp/source/ /tmp/destination/

<span class="command"># 3. Modifier quelques fichiers</span>
echo "Document 1 modifi√©" > /tmp/source/docs/doc1.txt
echo "Nouveau document" > /tmp/source/docs/doc3.txt

<span class="command"># 4. Synchronisation incr√©mentale</span>
rsync -av /tmp/source/ /tmp/destination/

<span class="command"># 5. V√©rifier les changements</span>
diff -r /tmp/source/ /tmp/destination/
                </div>
                
                <h3>TP 3 : Test de restauration</h3>
                
                <div class="code-block">
<span class="command"># 1. Cr√©er une base de donn√©es de test</span>
sqlite3 /tmp/test.db "CREATE TABLE users (id INTEGER, name TEXT);"
sqlite3 /tmp/test.db "INSERT INTO users VALUES (1, 'Alice'), (2, 'Bob');"

<span class="command"># 2. Sauvegarder</span>
tar -czf /tmp/db_backup.tar.gz /tmp/test.db

<span class="command"># 3. Corrompre la base</span>
echo "corruption" > /tmp/test.db

<span class="command"># 4. Restaurer</span>
tar -xzf /tmp/db_backup.tar.gz

<span class="command"># 5. V√©rifier l'int√©grit√©</span>
sqlite3 /tmp/test.db "SELECT * FROM users;"
                </div>
            </section>
            
            <section id="automatisation" class="section">
                <h2>Automatisation des sauvegardes</h2>
                
                <h3>Script de sauvegarde automatique</h3>
                
                <div class="code-block">
#!/bin/bash
# Script de sauvegarde automatique

<span class="command"># Configuration</span>
BACKUP_DIR="/backup"
SOURCE_DIRS="/home /etc /var/log"
RETENTION_DAYS=30
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_FILE="backup_$DATE.tar.gz"
LOG_FILE="/var/log/backup.log"

<span class="command"># Fonction de log</span>
log_message() {
    echo "$(date): $1" | tee -a $LOG_FILE
}

<span class="command"># V√©rifications pr√©alables</span>
if [ ! -d "$BACKUP_DIR" ]; then
    mkdir -p "$BACKUP_DIR"
fi

<span class="command"># D√©marrage de la sauvegarde</span>
log_message "D√©but de la sauvegarde"

<span class="command"># Cr√©ation de l'archive</span>
if tar -czf "$BACKUP_DIR/$BACKUP_FILE" $SOURCE_DIRS 2>/dev/null; then
    log_message "Sauvegarde r√©ussie: $BACKUP_FILE"
    
    <span class="command"># Calcul de la taille</span>
    SIZE=$(du -h "$BACKUP_DIR/$BACKUP_FILE" | cut -f1)
    log_message "Taille de la sauvegarde: $SIZE"
    
    <span class="command"># Nettoyage des anciennes sauvegardes</span>
    find "$BACKUP_DIR" -name "backup_*.tar.gz" -mtime +$RETENTION_DAYS -delete
    log_message "Nettoyage des sauvegardes anciennes termin√©"
    
else
    log_message "ERREUR: √âchec de la sauvegarde"
    exit 1
fi

log_message "Fin de la sauvegarde"
                </div>
                
                <h3>Configuration cron</h3>
                
                <div class="code-block">
<span class="command"># √âditer la crontab</span>
crontab -e

<span class="command"># Exemples de planifications</span>
# Sauvegarde quotidienne √† 2h du matin
0 2 * * * /usr/local/bin/backup.sh

# Sauvegarde hebdomadaire le dimanche √† 1h
0 1 * * 0 /usr/local/bin/backup_weekly.sh

# Sauvegarde mensuelle le 1er de chaque mois
0 0 1 * * /usr/local/bin/backup_monthly.sh

<span class="command"># Avec notification par email</span>
0 2 * * * /usr/local/bin/backup.sh | mail -s "Rapport de sauvegarde" admin@domaine.com
                </div>
                
                <h3>Surveillance des sauvegardes</h3>
                
                <div class="code-block">
#!/bin/bash
<span class="command"># Script de v√©rification des sauvegardes</span>

BACKUP_DIR="/backup"
MAX_AGE_HOURS=25  # 25 heures pour une sauvegarde quotidienne

<span class="command"># Trouver la sauvegarde la plus r√©cente</span>
LATEST_BACKUP=$(find "$BACKUP_DIR" -name "backup_*.tar.gz" -printf '%T@ %p\n' | sort -n | tail -1 | cut -d' ' -f2-)

if [ -z "$LATEST_BACKUP" ]; then
    echo "ALERTE: Aucune sauvegarde trouv√©e !"
    exit 1
fi

<span class="command"># V√©rifier l'√¢ge de la derni√®re sauvegarde</span>
BACKUP_AGE=$(find "$LATEST_BACKUP" -mmin +$((MAX_AGE_HOURS * 60)) | wc -l)

if [ $BACKUP_AGE -gt 0 ]; then
    echo "ALERTE: La derni√®re sauvegarde est trop ancienne !"
    ls -la "$LATEST_BACKUP"
    exit 1
else
    echo "OK: Sauvegarde r√©cente trouv√©e: $(basename $LATEST_BACKUP)"
fi

<span class="command"># Tester l'int√©grit√© de l'archive</span>
if tar -tzf "$LATEST_BACKUP" >/dev/null 2>&1; then
    echo "OK: L'archive est int√®gre"
else
    echo "ALERTE: L'archive est corrompue !"
    exit 1
fi
                </div>
                
                <h3>Bonnes pratiques</h3>
                
                <div class="success">
                    <strong>√Ä faire :</strong>
                    <ul style="margin-top: 0.5rem;">
                        <li>Tester r√©guli√®rement les restaurations</li>
                        <li>Documenter les proc√©dures</li>
                        <li>Surveiller l'espace disque</li>
                        <li>Chiffrer les sauvegardes sensibles</li>
                        <li>V√©rifier l'int√©grit√© des archives</li>
                    </ul>
                </div>
                
                <div class="warning">
                    <strong>√Ä √©viter :</strong>
                    <ul style="margin-top: 0.5rem;">
                        <li>Faire confiance aveugl√©ment aux sauvegardes</li>
                        <li>Stocker uniquement sur site</li>
                        <li>N√©gliger la s√©curit√© des sauvegardes</li>
                        <li>Oublier de nettoyer les anciennes sauvegardes</li>
                        <li>Ignorer les alertes de sauvegarde</li>
                    </ul>
                </div>
            </section>
            
            <section id="recovery" class="section">
                <h2>Proc√©dures de restauration</h2>
                
                <h3>Plan de reprise d'activit√© (PRA)</h3>
                <p>Un plan de reprise d'activit√© d√©finit les proc√©dures √† suivre en cas de sinistre pour restaurer les syst√®mes et donn√©es critiques.</p>
                
                <h3>Types de restauration</h3>
                
                <h4>Restauration compl√®te du syst√®me</h4>
                <div class="code-block">
<span class="command"># 1. D√©marrer depuis un live CD/USB</span>
# Boot depuis Ubuntu Live ou autre distribution

<span class="command"># 2. Pr√©parer les partitions</span>
fdisk -l  # Identifier les disques
mkfs.ext4 /dev/sda1  # Formater si n√©cessaire
mount /dev/sda1 /mnt

<span class="command"># 3. Restaurer depuis l'archive</span>
cd /mnt
tar -xzf /backup/system_backup.tar.gz

<span class="command"># 4. Restaurer le bootloader</span>
mount --bind /dev /mnt/dev
mount --bind /proc /mnt/proc
mount --bind /sys /mnt/sys
chroot /mnt
grub-install /dev/sda
update-grub
exit

<span class="command"># 5. Red√©marrer</span>
umount /mnt/dev /mnt/proc /mnt/sys /mnt
reboot
                </div>
                
                <h4>Restauration s√©lective</h4>
                <div class="code-block">
<span class="command"># Restaurer un fichier sp√©cifique</span>
tar -xzf backup.tar.gz ./home/user/document.txt

<span class="command"># Restaurer un r√©pertoire</span>
tar -xzf backup.tar.gz ./etc/

<span class="command"># Restaurer avec rsync depuis une sauvegarde</span>
rsync -av /backup/home/user/ /home/user/
                </div>
                
                <h3>Tests de restauration</h3>
                
                <div class="info">
                    <strong>Fr√©quence recommand√©e :</strong><br>
                    ‚Ä¢ Tests partiels : Mensuel<br>
                    ‚Ä¢ Tests complets : Trimestriel<br>
                    ‚Ä¢ Simulation de catastrophe : Annuel
                </div>
                
                <div class="code-block">
#!/bin/bash
<span class="command"># Script de test de restauration automatique</span>

TEST_DIR="/tmp/restore_test"
BACKUP_FILE="/backup/latest_backup.tar.gz"
LOG_FILE="/var/log/restore_test.log"

log_test() {
    echo "$(date): $1" | tee -a $LOG_FILE
}

<span class="command"># Pr√©paration de l'environnement de test</span>
rm -rf $TEST_DIR
mkdir -p $TEST_DIR
cd $TEST_DIR

log_test "D√©but du test de restauration"

<span class="command"># Test d'extraction</span>
if tar -xzf $BACKUP_FILE 2>/dev/null; then
    log_test "Extraction r√©ussie"
else
    log_test "ERREUR: √âchec de l'extraction"
    exit 1
fi

<span class="command"># V√©rification de l'int√©grit√© des fichiers critiques</span>
CRITICAL_FILES=("etc/passwd" "etc/shadow" "etc/fstab")

for file in "${CRITICAL_FILES[@]}"; do
    if [ -f "$file" ]; then
        log_test "OK: $file pr√©sent"
    else
        log_test "ERREUR: $file manquant"
    fi
done

<span class="command"># Nettoyage</span>
rm -rf $TEST_DIR
log_test "Test de restauration termin√©"
                </div>
            </section>
            
            <section id="advanced" class="section">
                <h2>Techniques avanc√©es</h2>
                
                <h3>Sauvegarde avec LVM snapshots</h3>
                <p>Les snapshots LVM permettent de cr√©er des sauvegardes coh√©rentes de volumes en cours d'utilisation.</p>
                
                <div class="code-block">
<span class="command"># Cr√©er un snapshot</span>
lvcreate -L 1G -s -n data_snapshot /dev/vg01/data

<span class="command"># Monter le snapshot</span>
mkdir /mnt/snapshot
mount /dev/vg01/data_snapshot /mnt/snapshot

<span class="command"># Sauvegarder depuis le snapshot</span>
tar -czf /backup/data_$(date +%Y%m%d).tar.gz /mnt/snapshot

<span class="command"># Nettoyer</span>
umount /mnt/snapshot
lvremove /dev/vg01/data_snapshot
                </div>
                
                <h3>Sauvegarde de bases de donn√©es</h3>
                
                <h4>MySQL/MariaDB</h4>
                <div class="code-block">
<span class="command"># Sauvegarde compl√®te</span>
mysqldump --all-databases --single-transaction --routines --triggers > backup_mysql.sql

<span class="command"># Sauvegarde d'une base sp√©cifique</span>
mysqldump --single-transaction mydb > backup_mydb.sql

<span class="command"># Sauvegarde avec compression</span>
mysqldump --all-databases --single-transaction | gzip > backup_mysql.sql.gz

<span class="command"># Restauration</span>
mysql < backup_mysql.sql
</div>
                
                <h4>PostgreSQL</h4>
                <div class="code-block">
<span class="command"># Sauvegarde compl√®te</span>
pg_dumpall > backup_postgresql.sql

<span class="command"># Sauvegarde d'une base sp√©cifique</span>
pg_dump mydb > backup_mydb.sql

<span class="command"># Sauvegarde au format custom</span>
pg_dump -Fc mydb > backup_mydb.dump

<span class="command"># Restauration</span>
psql < backup_postgresql.sql
pg_restore -d mydb backup_mydb.dump
                </div>
                
                <h3>Chiffrement des sauvegardes</h3>
                
                <div class="code-block">
<span class="command"># Avec GPG</span>
tar -czf - /home | gpg --cipher-algo AES256 --compress-algo 1 --symmetric --output backup_encrypted.tar.gz.gpg

<span class="command"># D√©chiffrement</span>
gpg --decrypt backup_encrypted.tar.gz.gpg | tar -xzf -

<span class="command"># Avec OpenSSL</span>
tar -czf - /home | openssl enc -aes-256-cbc -salt -out backup_encrypted.tar.gz.enc

<span class="command"># D√©chiffrement OpenSSL</span>
openssl enc -aes-256-cbc -d -in backup_encrypted.tar.gz.enc | tar -xzf -
                </div>
                
                <h3>Sauvegarde vers le cloud</h3>
                
                <div class="code-block">
<span class="command"># Avec rclone (support multi-cloud)</span>
# Configuration initiale
rclone config

<span class="command"># Synchronisation</span>
rclone sync /backup remote:backup-bucket

<span class="command"># Avec aws-cli (Amazon S3)</span>
aws s3 sync /backup s3://mon-bucket-backup --delete

<span class="command"># Avec gsutil (Google Cloud Storage)</span>
gsutil -m rsync -r -d /backup gs://mon-bucket-backup
                </div>
            </section>
            
            <section id="monitoring" class="section">
                <h2>Monitoring et alertes</h2>
                
                <h3>Script de monitoring des sauvegardes</h3>
                
                <div class="code-block">
#!/bin/bash
<span class="command"># Monitoring complet des sauvegardes</span>

BACKUP_DIR="/backup"
ALERT_EMAIL="admin@domaine.com"
MAX_AGE_HOURS=25
MIN_SIZE_MB=100

check_backup() {
    local backup_type=$1
    local pattern=$2
    local max_age=$3
    
    echo "=== V√©rification $backup_type ==="
    
    <span class="command"># Trouver la sauvegarde la plus r√©cente</span>
    latest=$(find "$BACKUP_DIR" -name "$pattern" -printf '%T@ %p\n' | sort -n | tail -1)
    
    if [ -z "$latest" ]; then
        echo "ERREUR: Aucune sauvegarde $backup_type trouv√©e"
        return 1
    fi
    
    backup_file=$(echo $latest | cut -d' ' -f2-)
    backup_time=$(echo $latest | cut -d' ' -f1)
    current_time=$(date +%s)
    age_hours=$(( (current_time - ${backup_time%.*}) / 3600 ))
    
    echo "Fichier: $(basename $backup_file)"
    echo "√Çge: $age_hours heures"
    
    <span class="command"># V√©rifier l'√¢ge</span>
    if [ $age_hours -gt $max_age ]; then
        echo "ALERTE: Sauvegarde trop ancienne ($age_hours > $max_age heures)"
        return 1
    fi
    
    <span class="command"># V√©rifier la taille</span>
    size_mb=$(du -m "$backup_file" | cut -f1)
    echo "Taille: ${size_mb}MB"
    
    if [ $size_mb -lt $MIN_SIZE_MB ]; then
        echo "ALERTE: Sauvegarde trop petite (${size_mb}MB < ${MIN_SIZE_MB}MB)"
        return 1
    fi
    
    <span class="command"># V√©rifier l'int√©grit√©</span>
    if file "$backup_file" | grep -q "gzip compressed"; then
        if gunzip -t "$backup_file" 2>/dev/null; then
            echo "OK: Archive int√®gre"
        else
            echo "ERREUR: Archive corrompue"
            return 1
        fi
    elif file "$backup_file" | grep -q "POSIX tar archive"; then
        if tar -tf "$backup_file" >/dev/null 2>&1; then
            echo "OK: Archive int√®gre"
        else
            echo "ERREUR: Archive corrompue"
            return 1
        fi
    fi
    
    echo "Statut: OK"
    return 0
}

<span class="command"># Rapport de monitoring</span>
REPORT_FILE="/tmp/backup_report_$(date +%Y%m%d_%H%M%S).txt"
exec > >(tee "$REPORT_FILE")

echo "RAPPORT DE MONITORING DES SAUVEGARDES"
echo "Date: $(date)"
echo "========================================="

<span class="command"># V√©rifier diff√©rents types de sauvegardes</span>
ERRORS=0

check_backup "quotidienne" "backup_daily_*.tar.gz" 25 || ((ERRORS++))
check_backup "hebdomadaire" "backup_weekly_*.tar.gz" 168 || ((ERRORS++))
check_backup "mensuelle" "backup_monthly_*.tar.gz" 744 || ((ERRORS++))

<span class="command"># V√©rifier l'espace disque</span>
echo ""
echo "=== Espace disque ==="
df -h "$BACKUP_DIR"

DISK_USAGE=$(df "$BACKUP_DIR" | tail -1 | awk '{print $5}' | sed 's/%//')
if [ $DISK_USAGE -gt 90 ]; then
    echo "ALERTE: Espace disque faible ($DISK_USAGE%)"
    ((ERRORS++))
fi

<span class="command"># R√©sum√©</span>
echo ""
echo "========================================="
if [ $ERRORS -eq 0 ]; then
    echo "R√âSULTAT: Toutes les v√©rifications sont OK"
    exit 0
else
    echo "R√âSULTAT: $ERRORS erreur(s) d√©tect√©e(s)"
    <span class="command"># Envoyer une alerte par email</span>
    mail -s "ALERTE: Probl√®me de sauvegarde" "$ALERT_EMAIL" < "$REPORT_FILE"
    exit 1
fi
                </div>
                
                <h3>Int√©gration avec Nagios/Icinga</h3>
                
                <div class="code-block">
<span class="command"># Plugin Nagios pour v√©rifier les sauvegardes</span>
#!/bin/bash
# /usr/lib/nagios/plugins/check_backup

BACKUP_DIR="/backup"
WARNING_AGE=24
CRITICAL_AGE=48

latest_backup=$(find "$BACKUP_DIR" -name "backup_*.tar.gz" -printf '%T@ %p\n' | sort -n | tail -1)

if [ -z "$latest_backup" ]; then
    echo "CRITICAL - Aucune sauvegarde trouv√©e"
    exit 2
fi

backup_file=$(echo $latest_backup | cut -d' ' -f2-)
backup_time=$(echo $latest_backup | cut -d' ' -f1)
current_time=$(date +%s)
age_hours=$(( (current_time - ${backup_time%.*}) / 3600 ))

if [ $age_hours -gt $CRITICAL_AGE ]; then
    echo "CRITICAL - Derni√®re sauvegarde: $age_hours heures"
    exit 2
elif [ $age_hours -gt $WARNING_AGE ]; then
    echo "WARNING - Derni√®re sauvegarde: $age_hours heures"
    exit 1
else
    echo "OK - Derni√®re sauvegarde: $age_hours heures"
    exit 0
fi
                </div>
            </section>
            
            <section id="exercices" class="section">
                <h2>Exercices pratiques</h2>
                
                <h3>Exercice 1: Mise en place d'une strat√©gie compl√®te</h3>
                
                <div class="info">
                    <strong>Objectif :</strong> Cr√©er un syst√®me de sauvegarde automatique pour un serveur web avec base de donn√©es.
                </div>
                
                <p><strong>√âtapes √† r√©aliser :</strong></p>
                <ol style="margin-left: 2rem; margin-top: 1rem;">
                    <li>Cr√©er l'arborescence de test avec des donn√©es simul√©es</li>
                    <li>√âcrire un script de sauvegarde diff√©rentielle</li>
                    <li>Configurer la planification avec cron</li>
                    <li>Impl√©menter la rotation des sauvegardes</li>
                    <li>Ajouter les v√©rifications d'int√©grit√©</li>
                    <li>Tester une proc√©dure de restauration compl√®te</li>
                </ol>
                
                <h3>Exercice 2: Sauvegarde chiffr√©e vers le cloud</h3>
                
                <div class="info">
                    <strong>Objectif :</strong> Configurer une sauvegarde automatique chiffr√©e vers un service cloud.
                </div>
                
                <div class="code-block">
<span class="command"># Structure √† cr√©er</span>
/opt/backup/
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ backup_encrypt.sh
‚îÇ   ‚îú‚îÄ‚îÄ upload_cloud.sh
‚îÇ   ‚îî‚îÄ‚îÄ verify_backup.sh
‚îú‚îÄ‚îÄ keys/
‚îÇ   ‚îî‚îÄ‚îÄ backup.key
‚îî‚îÄ‚îÄ logs/
    ‚îî‚îÄ‚îÄ backup.log
                </div>
                
                <h3>Exercice 3: Disaster Recovery complet</h3>
                
                <div class="info">
                    <strong>Sc√©nario :</strong> Simuler une panne compl√®te du serveur et restaurer tous les services.
                </div>
                
                <p><strong>Services √† sauvegarder et restaurer :</strong></p>
                <ul style="margin-left: 2rem; margin-top: 1rem;">
                    <li>Apache/Nginx + sites web</li>
                    <li>Base de donn√©es MySQL</li>
                    <li>Comptes utilisateurs</li>
                    <li>Configurations syst√®me</li>
                    <li>Certificats SSL</li>
                    <li>T√¢ches cron</li>
                </ul>
            </section>
            
            <section id="troubleshooting" class="section">
                <h2>D√©pannage des sauvegardes</h2>
                
                <h3>Probl√®mes courants</h3>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Probl√®me</th>
                                <th>Sympt√¥me</th>
                                <th>Cause possible</th>
                                <th>Solution</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Archive corrompue</td>
                                <td>Erreur √† l'extraction</td>
                                <td>Interruption, disque plein</td>
                                <td>Utiliser checksums, v√©rifier l'espace</td>
                            </tr>
                            <tr>
                                <td>Sauvegarde incompl√®te</td>
                                <td>Fichiers manquants</td>
                                <td>Permissions, fichiers ouverts</td>
                                <td>Ajuster les permissions, utiliser snapshots</td>
                            </tr>
                            <tr>
                                <td>Lenteur excessive</td>
                                <td>Temps d'ex√©cution long</td>
                                <td>I/O disque, r√©seau</td>
                                <td>Optimiser la compression, horaires</td>
                            </tr>
                            <tr>
                                <td>Espace insuffisant</td>
                                <td>Erreur "No space left"</td>
                                <td>Croissance des donn√©es</td>
                                <td>Rotation, compression, nettoyage</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <h3>Outils de diagnostic</h3>
                
                <div class="code-block">
<span class="command"># V√©rifier l'int√©grit√© d'une archive tar</span>
tar -tvf archive.tar.gz | wc -l  # Compter les fichiers
tar -tzf archive.tar.gz >/dev/null && echo "OK" || echo "Erreur"

<span class="command"># Analyser les logs de sauvegarde</span>
grep -i error /var/log/backup.log
grep -i warning /var/log/backup.log

<span class="command"># V√©rifier les checksums</span>
find /backup -name "*.tar.gz" -exec md5sum {} \; > checksums.md5
md5sum -c checksums.md5

<span class="command"># Tester la vitesse de compression</span>
time tar -czf test.tar.gz /large_directory
time tar -cjf test.tar.bz2 /large_directory
time tar -cJf test.tar.xz /large_directory
                </div>
            </section>
            
            <section id="conclusion" class="section">
                <h2>R√©capitulatif et bonnes pratiques</h2>
                
                <h3>Points cl√©s √† retenir</h3>
                
                <div class="success">
                    <ul style="margin-top: 0.5rem;">
                        <li><strong>Planification :</strong> D√©finir une strat√©gie claire (3-2-1)</li>
                        <li><strong>Automatisation :</strong> Utiliser cron et des scripts robustes</li>
                        <li><strong>V√©rification :</strong> Tester r√©guli√®rement les restaurations</li>
                        <li><strong>Monitoring :</strong> Surveiller et alerter en cas de probl√®me</li>
                        <li><strong>Documentation :</strong> Maintenir des proc√©dures √† jour</li>
                        <li><strong>S√©curit√© :</strong> Chiffrer les donn√©es sensibles</li>
                        <li><strong>Diversification :</strong> Utiliser plusieurs supports et emplacements</li>
                    </ul>
                </div>
                
                <h3>Checklist de mise en ≈ìuvre</h3>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>T√¢che</th>
                                <th>Fr√©quence</th>
                                <th>Responsable</th>
                                <th>Statut</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>D√©finir la politique de sauvegarde</td>
                                <td>Une fois</td>
                                <td>Admin syst√®me</td>
                                <td>‚òê</td>
                            </tr>
                            <tr>
                                <td>Installer et configurer les outils</td>
                                <td>Une fois</td>
                                <td>Admin syst√®me</td>
                                <td>‚òê</td>
                            </tr>
                            <tr>
                                <td>Cr√©er les scripts de sauvegarde</td>
                                <td>Une fois</td>
                                <td>Admin syst√®me</td>
                                <td>‚òê</td>
                            </tr>
                            <tr>
                                <td>Configurer la planification</td>
                                <td>Une fois</td>
                                <td>Admin syst√®me</td>
                                <td>‚òê</td>
                            </tr>
                            <tr>
                                <td>Mettre en place le monitoring</td>
                                <td>Une fois</td>
                                <td>Admin syst√®me</td>
                                <td>‚òê</td>
                            </tr>
                            <tr>
                                <td>Tester les restaurations</td>
                                <td>Mensuel</td>
                                <td>Admin syst√®me</td>
                                <td>‚òê</td>
                            </tr>
                            <tr>
                                <td>V√©rifier les alertes</td>
                                <td>Quotidien</td>
                                <td>Admin syst√®me</td>
                                <td>‚òê</td>
                            </tr>
                            <tr>
                                <td>R√©viser la strat√©gie</td>
                                <td>Annuel</td>
                                <td>Direction IT</td>
                                <td>‚òê</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <h3>Ressources suppl√©mentaires</h3>
                
                <ul style="margin-left: 2rem; margin-top: 1rem;">
                    <li><strong>Documentation officielle :</strong> man tar, man rsync, man crontab</li>
                    <li><strong>Sites de r√©f√©rence :</strong> BackupCentral.com, LinuxBackup.net</li>
                    <li><strong>Outils recommand√©s :</strong> Bacula, Amanda, Duplicity, BorgBackup</li>
                    <li><strong>Tests de performance :</strong> Bonnie++, IOzone pour tester les performances I/O</li>
                </ul>
                
                <div class="info">
                    <strong>Prochaine √©tape :</strong> Jour 24 - Virtualisation<br>
                    Nous explorerons les technologies de virtualisation et leur impact sur les strat√©gies de sauvegarde.
                </div>
            </section>
        </main>
        
        <footer class="footer">
            <p>&copy; 2025 Formation Linux - Jean Tene. Support de cours Jour 23 : Sauvegarde et restauration</p>
            <p>Ce document est distribu√© sous licence Creative Commons BY-SA</p>
        </footer>
    </div>
    
    <script>
        // Animation au scroll
        window.addEventListener('scroll', function() {
            const sections = document.querySelectorAll('.section');
            const scrollPos = window.scrollY + window.innerHeight;
            
            sections.forEach(section => {
                if (scrollPos > section.offsetTop + 100) {
                    section.style.opacity = '1';
                    section.style.transform = 'translateY(0)';
                }
            });
        });
        
        // Navigation smooth scroll
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });
        
        // Highlight du code
        document.querySelectorAll('.code-block').forEach(block => {
            block.addEventListener('click', function() {
                const selection = window.getSelection();
                const range = document.createRange();
                range.selectNodeContents(this);
                selection.removeAllRanges();
                selection.addRange(range);
            });
        });
        
        // Animation des sections au chargement
        document.addEventListener('DOMContentLoaded', function() {
            const sections = document.querySelectorAll('.section');
            sections.forEach((section, index) => {
                section.style.opacity = '0';
                section.style.transform = 'translateY(20px)';
                section.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
                
                setTimeout(() => {
                    section.style.opacity = '1';
                    section.style.transform = 'translateY(0)';
                }, index * 100);
            });
        });
    </script>
</body>
</html>