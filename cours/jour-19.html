<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jour 19 - Gestion des logs sous Linux</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .header .subtitle {
            color: #7f8c8d;
            font-size: 1.2em;
            font-weight: 300;
        }
        
        .content-grid {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .main-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .sidebar {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            height: fit-content;
            position: sticky;
            top: 20px;
        }
        
        .sidebar h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 5px;
        }
        
        .sidebar ul {
            list-style: none;
        }
        
        .sidebar li {
            margin-bottom: 8px;
        }
        
        .sidebar a {
            color: #555;
            text-decoration: none;
            transition: all 0.3s ease;
            display: block;
            padding: 5px 10px;
            border-radius: 8px;
        }
        
        .sidebar a:hover {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            transform: translateX(5px);
        }
        
        .section {
            margin-bottom: 40px;
        }
        
        .section h2 {
            color: #2c3e50;
            font-size: 1.8em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
            position: relative;
        }
        
        .section h2::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 0;
            width: 50px;
            height: 3px;
            background: #764ba2;
        }
        
        .section h3 {
            color: #34495e;
            font-size: 1.4em;
            margin: 25px 0 15px 0;
            padding-left: 15px;
            border-left: 4px solid #667eea;
        }
        
        .code-block {
            background: #1e1e1e;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            overflow-x: auto;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .code-block .command {
            color: #50fa7b;
        }
        
        .code-block .output {
            color: #8be9fd;
        }
        
        .code-block .comment {
            color: #6272a4;
        }
        
        .alert {
            padding: 15px;
            margin: 15px 0;
            border-radius: 10px;
            border-left: 5px solid;
        }
        
        .alert-info {
            background: #e8f4fd;
            border-color: #3498db;
            color: #2980b9;
        }
        
        .alert-warning {
            background: #fef9e7;
            border-color: #f39c12;
            color: #e67e22;
        }
        
        .alert-danger {
            background: #fdeaea;
            border-color: #e74c3c;
            color: #c0392b;
        }
        
        .alert-success {
            background: #eafaf1;
            border-color: #27ae60;
            color: #229954;
        }
        
        .table-container {
            overflow-x: auto;
            margin: 20px 0;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            font-weight: 600;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .exercise {
            background: linear-gradient(135deg, #667eea20, #764ba220);
            border: 2px solid #667eea;
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
        }
        
        .exercise h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        
        .exercise ol {
            padding-left: 20px;
        }
        
        .exercise li {
            margin-bottom: 10px;
        }
        
        @media (max-width: 768px) {
            .content-grid {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                order: -1;
                position: static;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .container {
                padding: 10px;
            }
        }
        
        .highlight {
            background: linear-gradient(120deg, #a8edea 0%, #fed6e3 100%);
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Jour 19 - Gestion des logs</h1>
            <p class="subtitle">Formation Administration Système Linux - Jean Tene</p>
        </div>
        
        <div class="content-grid">
            <div class="main-content">
                <div class="section" id="introduction">
                    <h2>1. Introduction à la gestion des logs</h2>
                    
                    <h3>Qu'est-ce qu'un log ?</h3>
                    <p>Un <span class="highlight">log</span> (ou journal) est un fichier texte qui enregistre de manière chronologique les événements qui se produisent sur un système informatique. Ces événements peuvent inclure :</p>
                    <ul>
                        <li>Démarrage et arrêt de services</li>
                        <li>Connexions et déconnexions d'utilisateurs</li>
                        <li>Erreurs système et applications</li>
                        <li>Activités de sécurité</li>
                        <li>Performances système</li>
                    </ul>
                    
                    <div class="alert alert-info">
                        <strong>Pourquoi les logs sont-ils importants ?</strong><br>
                        Les logs sont essentiels pour le dépannage, la surveillance de la sécurité, l'analyse des performances et la conformité réglementaire.
                    </div>
                    
                    <h3>Types de logs sous Linux</h3>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Type de log</th>
                                    <th>Description</th>
                                    <th>Fichier typique</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Logs système</td>
                                    <td>Messages généraux du système</td>
                                    <td>/var/log/syslog</td>
                                </tr>
                                <tr>
                                    <td>Logs de sécurité</td>
                                    <td>Authentifications, autorisations</td>
                                    <td>/var/log/auth.log</td>
                                </tr>
                                <tr>
                                    <td>Logs du noyau</td>
                                    <td>Messages du kernel Linux</td>
                                    <td>/var/log/kern.log</td>
                                </tr>
                                <tr>
                                    <td>Logs d'applications</td>
                                    <td>Messages des applications</td>
                                    <td>/var/log/apache2/</td>
                                </tr>
                                <tr>
                                    <td>Logs de boot</td>
                                    <td>Messages de démarrage</td>
                                    <td>/var/log/boot.log</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="section" id="structure">
                    <h2>2. Structure et emplacement des logs</h2>
                    
                    <h3>Hiérarchie des logs</h3>
                    <p>Sous Linux, les logs sont principalement stockés dans le répertoire <code>/var/log/</code>. Voici la structure typique :</p>
                    
                    <div class="code-block">
<span class="command">ls -la /var/log/</span>
<span class="output">
drwxr-xr-x  8 root root  4096 nov 15 10:30 .
drwxr-xr-x 12 root root  4096 oct 20 14:22 ..
-rw-r--r--  1 root root 15234 nov 15 10:30 alternatives.log
-rw-r-----  1 syslog adm 45678 nov 15 10:30 auth.log
-rw-r--r--  1 root root  2345 nov 15 09:15 boot.log
-rw-r-----  1 syslog adm 78901 nov 15 10:30 kern.log
-rw-r-----  1 syslog adm 123456 nov 15 10:30 syslog
drwxr-xr-x  2 root root  4096 nov 10 08:00 apache2/
drwxr-xr-x  2 root root  4096 nov 12 12:15 mysql/
</span>
                    </div>
                    
                    <h3>Principaux fichiers de logs</h3>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Fichier</th>
                                    <th>Contenu</th>
                                    <th>Rotation</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>/var/log/syslog</td>
                                    <td>Messages système généraux</td>
                                    <td>Quotidienne</td>
                                </tr>
                                <tr>
                                    <td>/var/log/auth.log</td>
                                    <td>Authentifications et autorisations</td>
                                    <td>Quotidienne</td>
                                </tr>
                                <tr>
                                    <td>/var/log/kern.log</td>
                                    <td>Messages du noyau</td>
                                    <td>Quotidienne</td>
                                </tr>
                                <tr>
                                    <td>/var/log/messages</td>
                                    <td>Messages système (Red Hat/CentOS)</td>
                                    <td>Hebdomadaire</td>
                                </tr>
                                <tr>
                                    <td>/var/log/secure</td>
                                    <td>Sécurité (Red Hat/CentOS)</td>
                                    <td>Hebdomadaire</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="alert alert-warning">
                        <strong>Attention :</strong> Les noms et emplacements des fichiers de logs peuvent varier selon la distribution Linux utilisée.
                    </div>
                </div>
                
                <div class="section" id="rsyslog">
                    <h2>3. Rsyslog - Le gestionnaire de logs</h2>
                    
                    <h3>Qu'est-ce que Rsyslog ?</h3>
                    <p><span class="highlight">Rsyslog</span> est le service de gestion des logs par défaut sur la plupart des distributions Linux modernes. Il collecte, traite et distribue les messages de log selon des règles configurables.</p>
                    
                    <h3>Configuration de Rsyslog</h3>
                    <p>Le fichier de configuration principal est <code>/etc/rsyslog.conf</code>. Les configurations additionnelles se trouvent dans <code>/etc/rsyslog.d/</code>.</p>
                    
                    <div class="code-block">
<span class="command">sudo nano /etc/rsyslog.conf</span>
<span class="comment"># Exemple de configuration rsyslog</span>
<span class="output">
# Modules
$ModLoad imuxsock # provides support for local system logging
$ModLoad imklog   # provides kernel logging support

# Règles de log
*.info;mail.none;authpriv.none;cron.none    /var/log/messages
authpriv.*                                  /var/log/secure
mail.*                                      /var/log/maillog
cron.*                                      /var/log/cron
*.emerg                                     *
</span>
                    </div>
                    
                    <h3>Syntaxe des règles Rsyslog</h3>
                    <p>Les règles suivent le format : <code>facility.priority    action</code></p>
                    
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Facility</th>
                                    <th>Description</th>
                                    <th>Priority</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>kern</td>
                                    <td>Noyau</td>
                                    <td>emerg</td>
                                    <td>Urgence système</td>
                                </tr>
                                <tr>
                                    <td>user</td>
                                    <td>Utilisateur</td>
                                    <td>alert</td>
                                    <td>Action immédiate</td>
                                </tr>
                                <tr>
                                    <td>mail</td>
                                    <td>Système mail</td>
                                    <td>crit</td>
                                    <td>Critique</td>
                                </tr>
                                <tr>
                                    <td>daemon</td>
                                    <td>Services système</td>
                                    <td>err</td>
                                    <td>Erreur</td>
                                </tr>
                                <tr>
                                    <td>auth</td>
                                    <td>Sécurité/autorisation</td>
                                    <td>warning</td>
                                    <td>Avertissement</td>
                                </tr>
                                <tr>
                                    <td>local0-7</td>
                                    <td>Usage local</td>
                                    <td>info</td>
                                    <td>Information</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <h3>Gestion du service Rsyslog</h3>
                    <div class="code-block">
<span class="comment"># Vérifier le statut</span>
<span class="command">sudo systemctl status rsyslog</span>

<span class="comment"># Redémarrer le service</span>
<span class="command">sudo systemctl restart rsyslog</span>

<span class="comment"># Recharger la configuration</span>
<span class="command">sudo systemctl reload rsyslog</span>

<span class="comment"># Activer au démarrage</span>
<span class="command">sudo systemctl enable rsyslog</span>
                    </div>
                </div>
                
                <div class="section" id="consultation">
                    <h2>4. Consultation et analyse des logs</h2>
                    
                    <h3>Commandes de base pour lire les logs</h3>
                    
                    <h4>Affichage simple avec cat</h4>
                    <div class="code-block">
<span class="command">cat /var/log/syslog</span>
<span class="comment"># Affiche tout le contenu du fichier</span>
                    </div>
                    
                    <h4>Affichage paginé avec less</h4>
                    <div class="code-block">
<span class="command">less /var/log/syslog</span>
<span class="comment"># Navigation avec flèches, q pour quitter</span>
                    </div>
                    
                    <h4>Dernières lignes avec tail</h4>
                    <div class="code-block">
<span class="command">tail /var/log/syslog</span>
<span class="comment"># Affiche les 10 dernières lignes</span>

<span class="command">tail -n 50 /var/log/syslog</span>
<span class="comment"># Affiche les 50 dernières lignes</span>

<span class="command">tail -f /var/log/syslog</span>
<span class="comment"># Suivi en temps réel (Ctrl+C pour arrêter)</span>
                    </div>
                    
                    <h4>Premières lignes avec head</h4>
                    <div class="code-block">
<span class="command">head /var/log/syslog</span>
<span class="comment"># Affiche les 10 premières lignes</span>

<span class="command">head -n 20 /var/log/syslog</span>
<span class="comment"># Affiche les 20 premières lignes</span>
                    </div>
                    
                    <h3>Recherche dans les logs avec grep</h3>
                    <div class="code-block">
<span class="comment"># Rechercher un terme spécifique</span>
<span class="command">grep "error" /var/log/syslog</span>

<span class="comment"># Recherche insensible à la casse</span>
<span class="command">grep -i "ERROR" /var/log/syslog</span>

<span class="comment"># Recherche avec contexte</span>
<span class="command">grep -A 5 -B 5 "failed" /var/log/auth.log</span>

<span class="comment"># Recherche dans plusieurs fichiers</span>
<span class="command">grep -r "connection" /var/log/</span>

<span class="comment"># Compter les occurrences</span>
<span class="command">grep -c "login" /var/log/auth.log</span>
                    </div>
                    
                    <h3>Analyse avec awk et sed</h3>
                    <div class="code-block">
<span class="comment"># Extraire une colonne spécifique</span>
<span class="command">awk '{print $1, $2, $3}' /var/log/syslog</span>

<span class="comment"># Filtrer par date</span>
<span class="command">awk '/Nov 15/ {print}' /var/log/syslog</span>

<span class="comment"># Compter les IP uniques</span>
<span class="command">awk '{print $NF}' /var/log/auth.log | sort | uniq -c</span>
                    </div>
                </div>
                
                <div class="section" id="journalctl">
                    <h2>5. Journalctl et systemd</h2>
                    
                    <h3>Introduction à journalctl</h3>
                    <p><span class="highlight">Journalctl</span> est l'outil de consultation des journaux systemd. Il offre une interface puissante pour interroger les logs système.</p>
                    
                    <h3>Commandes journalctl essentielles</h3>
                    <div class="code-block">
<span class="comment"># Afficher tous les logs</span>
<span class="command">journalctl</span>

<span class="comment"># Logs depuis le dernier boot</span>
<span class="command">journalctl -b</span>

<span class="comment"># Logs d'un service spécifique</span>
<span class="command">journalctl -u ssh.service</span>

<span class="comment"># Suivi en temps réel</span>
<span class="command">journalctl -f</span>

<span class="comment"># Logs par priorité</span>
<span class="command">journalctl -p err</span>

<span class="comment"># Logs d'une période</span>
<span class="command">journalctl --since "2024-01-01" --until "2024-01-31"</span>

<span class="comment"># Logs du jour</span>
<span class="command">journalctl --since today</span>
                    </div>
                    
                    <h3>Filtrage avancé</h3>
                    <div class="code-block">
<span class="comment"># Par utilisateur</span>
<span class="command">journalctl _UID=1000</span>

<span class="comment"># Par processus</span>
<span class="command">journalctl _PID=1234</span>

<span class="comment"># Par exécutable</span>
<span class="command">journalctl _EXE=/usr/bin/ssh</span>

<span class="comment"># Combiner plusieurs filtres</span>
<span class="command">journalctl -u ssh.service --since "1 hour ago"</span>
                    </div>
                    
                    <h3>Configuration du journal systemd</h3>
                    <div class="code-block">
<span class="command">sudo nano /etc/systemd/journald.conf</span>
<span class="output">
[Journal]
Storage=persistent
Compress=yes
MaxRetentionSec=1month
MaxFileSec=1week
</span>
                    </div>
                    
                    <div class="alert alert-info">
                        <strong>Astuce :</strong> Utilisez <code>journalctl --disk-usage</code> pour vérifier l'espace utilisé par les journaux.
                    </div>
                </div>
                
                <div class="section" id="rotation">
                    <h2>6. Rotation des logs avec logrotate</h2>
                    
                    <h3>Qu'est-ce que logrotate ?</h3>
                    <p><span class="highlight">Logrotate</span> est un utilitaire qui automatise la rotation, la compression et la suppression des fichiers de logs pour éviter qu'ils consomment tout l'espace disque.</p>
                    
                    <h3>Configuration de logrotate</h3>
                    <p>Le fichier de configuration principal est <code>/etc/logrotate.conf</code>, avec des configurations spécifiques dans <code>/etc/logrotate.d/</code>.</p>
                    
                    <div class="code-block">
<span class="command">cat /etc/logrotate.conf</span>
<span class="output">
# Global settings
weekly
rotate 4
create
dateext
compress
delaycompress

# Include directory
include /etc/logrotate.d
</span>
                    </div>
                    
                    <h3>Exemple de configuration spécifique</h3>
                    <div class="code-block">
<span class="command">sudo nano /etc/logrotate.d/myapp</span>
<span class="output">
/var/log/myapp/*.log {
    daily
    rotate 30
    compress
    delaycompress
    missingok
    notifempty
    create 0644 myapp myapp
    postrotate
        systemctl reload myapp
    endscript
}
</span>
                    </div>
                    
                    <h3>Options de logrotate</h3>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Option</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>daily/weekly/monthly</td>
                                    <td>Fréquence de rotation</td>
                                </tr>
                                <tr>
                                    <td>rotate X</td>
                                    <td>Nombre de fichiers à conserver</td>
                                </tr>
                                <tr>
                                    <td>compress</td>
                                    <td>Compresser les anciens logs</td>
                                </tr>
                                <tr>
                                    <td>delaycompress</td>
                                    <td>Retarder la compression d'un cycle</td>
                                </tr>
                                <tr>
                                    <td>missingok</td>
                                    <td>Ignorer si le fichier n'existe pas</td>
                                </tr>
                                <tr>
                                    <td>notifempty</td>
                                    <td>Ne pas faire la rotation si vide</td>
                                </tr>
                                <tr>
                                    <td>create mode owner group</td>
                                    <td>Créer un nouveau fichier</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <h3>Tests et gestion de logrotate</h3>
                    <div class="code-block">
<span class="comment"># Test de la configuration</span>
<span class="command">sudo logrotate -d /etc/logrotate.conf</span>

<span class="comment"># Forcer la rotation</span>
<span class="command">sudo logrotate -f /etc/logrotate.conf</span>

<span class="comment"># Vérifier le statut</span>
<span class="command">cat /var/lib/logrotate/status</span>
                    </div>
                </div>
                
                <div class="section" id="monitoring">
                    <h2>7. Surveillance et alertes</h2>
                    
                    <h3>Surveillance en temps réel</h3>
                    <div class="code-block">
<span class="comment"># Surveillance continue avec tail</span>
<span class="command">tail -f /var/log/syslog | grep -i error</span>

<span class="comment"># Surveillance de plusieurs fichiers</span>
<span class="command">multitail /var/log/syslog /var/log/auth.log</span>

<span class="comment"># Avec journalctl</span>
<span class="command">journalctl -f -p err</span>
                    </div>
                    
                    <h3>Scripts d'alerte simples</h3>
                    <div class="code-block">
<span class="command">nano /usr/local/bin/log-alert.sh</span>
<span class="output">
#!/bin/bash
# Script d'alerte pour erreurs critiques

LOG_FILE="/var/log/syslog"
ALERT_EMAIL="admin@example.com"

# Rechercher les erreurs critiques des 5 dernières minutes
ERRORS=$(grep "$(date -d '5 minutes ago' '+%b %d %H:%M')" "$LOG_FILE" | grep -i "critical\|fatal\|panic")

if [ ! -z "$ERRORS" ]; then
    echo "Erreurs critiques détectées:" | mail -s "ALERTE SYSTÈME" "$ALERT_EMAIL"
    echo "$ERRORS" | mail -s "ALERTE SYSTÈME" "$ALERT_EMAIL"
fi
</span>
                    </div>
                    
                    <h3>Utilisation de logcheck</h3>
                    <div class="code-block">
<span class="comment"># Installation de logcheck</span>
<span class="command">sudo apt install logcheck</span>

<span class="comment"># Configuration</span>
<span class="command">sudo nano /etc/logcheck/logcheck.conf</span>
<span class="output">
REPORTLEVEL="paranoid"
SENDMAILTO="admin@example.com"
MAILASATTACH=0
</span>

<span class="comment"># Exécution manuelle</span>
<span class="command">sudo -u logcheck logcheck</span>
                    </div>
                </div>
                
                <div class="section" id="outils">
                    <h2>8. Outils avancés d'analyse des logs</h2>
                    
                    <h3>Analyseurs de logs en ligne de commande</h3>
                    
                    <h4>GoAccess (pour logs web)</h4>
                    <div class="code-block">
<span class="comment"># Installation</span>
<span class="command">sudo apt install goaccess</span>

<span class="comment"># Analyse des logs Apache en temps réel</span>
<span class="command">goaccess /var/log/apache2/access.log --log-format=COMBINED</span>

<span class="comment"># Génération d'un rapport HTML</span>
<span class="command">goaccess /var/log/apache2/access.log -o /var/www/html/report.html --log-format=COMBINED --real-time-html</span>
                    </div>
                    
                    <h4>Fail2ban (sécurité)</h4>
                    <div class="code-block">
<span class="comment"># Installation</span>
<span class="command">sudo apt install fail2ban</span>

<span class="comment"># Configuration</span>
<span class="command">sudo nano /etc/fail2ban/jail.local</span>
<span class="output">
[DEFAULT]
bantime = 3600
findtime = 600
maxretry = 3

[sshd]
enabled = true
port = ssh
logpath = /var/log/auth.log
</span>

<span class="comment"># Statut des jails</span>
<span class="command">sudo fail2ban-client status</span>
                    </div>
                    
                    <h3>Centralisation des logs</h3>
                    
                    <h4>Configuration d'un serveur rsyslog centralisé</h4>
                    <div class="code-block">
<span class="comment"># Sur le serveur central</span>
<span class="command">sudo nano /etc/rsyslog.conf</span>
<span class="output">
# Activer la réception UDP
$ModLoad imudp
$UDPServerRun 514
$UDPServerAddress 0.0.0.0

# Activer la réception TCP
$ModLoad imtcp
$InputTCPServerRun 514

# Template pour séparer les logs par client
$template RemoteLogs,"/var/log/remote/%HOSTNAME%/%PROGRAMNAME%.log"
*.* ?RemoteLogs
& stop
</span>

<span class="comment"># Sur les clients</span>
<span class="command">sudo nano /etc/rsyslog.conf</span>
<span class="output">
# Envoyer tous les logs vers le serveur central
*.* @@log-server.example.com:514
</span>
                    </div>
                    
                    <h3>Outils graphiques et dashboards</h3>
                    <div class="alert alert-info">
                        <strong>Solutions populaires :</strong><br>
                        • <strong>ELK Stack</strong> (Elasticsearch, Logstash, Kibana)<br>
                        • <strong>Graylog</strong> - Solution open source<br>
                        • <strong>Splunk</strong> - Solution commerciale<br>
                        • <strong>Fluentd</strong> - Collecteur de logs unifié
                    </div>
                </div>
                
                <div class="section" id="securite">
                    <h2>9. Sécurité et intégrité des logs</h2>
                    
                    <h3>Protection des fichiers de logs</h3>
                    <div class="code-block">
<span class="comment"># Vérifier les permissions</span>
<span class="command">ls -la /var/log/</span>

<span class="comment"># Ajuster les permissions</span>
<span class="command">sudo chmod 640 /var/log/auth.log</span>
<span class="command">sudo chown syslog:adm /var/log/auth.log</span>

<span class="comment"># Protéger contre la modification</span>
<span class="command">sudo chattr +a /var/log/secure.log</span>
<span class="comment"># +a = append only (ajout seulement)</span>
                    </div>
                    
                    <h3>Signature et intégrité</h3>
                    <div class="code-block">
<span class="comment"># Créer une empreinte des logs</span>
<span class="command">find /var/log -type f -name "*.log" -exec md5sum {} \; > /root/logs_checksum.md5</span>

<span class="comment"># Vérifier l'intégrité</span>
<span class="command">md5sum -c /root/logs_checksum.md5</span>

<span class="comment"># Avec rsyslog et signatures</span>
<span class="command">sudo nano /etc/rsyslog.conf</span>
<span class="output">
# Activer la signature des logs
$ActionQueueFileName fwdRule1
$ActionQueueMaxDiskSpace 1g
$ActionQueueSaveOnShutdown on
$ActionQueueType LinkedList
$ActionResumeRetryCount -1
*.* @@remote-server:514
</span>
                    </div>
                    
                    <h3>Audit avec auditd</h3>
                    <div class="code-block">
<span class="comment"># Installation d'auditd</span>
<span class="command">sudo apt install auditd audispd-plugins</span>

<span class="comment"># Configuration des règles d'audit</span>
<span class="command">sudo nano /etc/audit/rules.d/audit.rules</span>
<span class="output">
# Surveiller l'accès aux logs
-w /var/log/ -p wa -k log_access

# Surveiller les modifications de configuration
-w /etc/rsyslog.conf -p wa -k rsyslog_config
-w /etc/logrotate.conf -p wa -k logrotate_config

# Surveiller les commandes privilégiées
-a always,exit -F arch=b64 -S execve -F euid=0 -k privileged_commands
</span>

<span class="comment"># Rechercher dans les logs d'audit</span>
<span class="command">ausearch -k log_access</span>
<span class="command">aureport --summary</span>
                    </div>
                </div>
                
                <div class="section" id="performance">
                    <h2>10. Optimisation et performances</h2>
                    
                    <h3>Gestion de l'espace disque</h3>
                    <div class="code-block">
<span class="comment"># Vérifier l'utilisation de l'espace</span>
<span class="command">du -sh /var/log/*</span>

<span class="comment"># Trouver les plus gros fichiers</span>
<span class="command">find /var/log -type f -size +100M -exec ls -lh {} \;</span>

<span class="comment"># Nettoyer les anciens logs</span>
<span class="command">sudo find /var/log -name "*.log.*" -mtime +30 -delete</span>

<span class="comment"># Vider un log actif sans redémarrer le service</span>
<span class="command">sudo truncate -s 0 /var/log/syslog</span>
<span class="comment"># Ou</span>
<span class="command">sudo > /var/log/syslog</span>
                    </div>
                    
                    <h3>Configuration pour haute performance</h3>
                    <div class="code-block">
<span class="command">sudo nano /etc/rsyslog.conf</span>
<span class="output">
# Optimisations de performance
$MainMsgQueueSize 50000
$ActionQueueSize 25000
$ActionQueueDiscardMark 24000
$ActionQueueHighWaterMark 20000
$ActionQueueLowWaterMark 2000
$ActionQueueTimeoutShutdown 10
$ActionQueueWorkerThreads 2
$ActionQueueType LinkedList
</span>
                    </div>
                    
                    <h3>Partitionnement des logs</h3>
                    <div class="alert alert-success">
                        <strong>Bonnes pratiques :</strong><br>
                        • Utiliser une partition séparée pour /var/log<br>
                        • Implémenter la compression automatique<br>
                        • Configurer des quotas utilisateur si nécessaire<br>
                        • Utiliser des disques rapides pour les logs critiques
                    </div>
                </div>
                
                <div class="section" id="troubleshooting">
                    <h2>11. Dépannage courant</h2>
                    
                    <h3>Problèmes fréquents</h3>
                    
                    <h4>Logs qui ne se créent pas</h4>
                    <div class="code-block">
<span class="comment"># Vérifier le service rsyslog</span>
<span class="command">sudo systemctl status rsyslog</span>

<span class="comment"># Vérifier la configuration</span>
<span class="command">sudo rsyslogd -N1</span>

<span class="comment"># Vérifier les permissions</span>
<span class="command">ls -la /var/log/</span>

<span class="comment"># Recréer un fichier de log</span>
<span class="command">sudo touch /var/log/myapp.log</span>
<span class="command">sudo chown syslog:adm /var/log/myapp.log</span>
<span class="command">sudo chmod 644 /var/log/myapp.log</span>
                    </div>
                    
                    <h4>Espace disque plein</h4>
                    <div class="code-block">
<span class="comment"># Identifier les gros fichiers</span>
<span class="command">sudo du -ah /var/log/ | sort -rh | head -20</span>

<span class="comment"># Forcer la rotation immédiate</span>
<span class="command">sudo logrotate -f /etc/logrotate.conf</span>

<span class="comment"># Nettoyer les journaux systemd</span>
<span class="command">sudo journalctl --vacuum-time=7d</span>
<span class="command">sudo journalctl --vacuum-size=500M</span>
                    </div>
                    
                    <h4>Logs corrompus</h4>
                    <div class="code-block">
<span class="comment"># Vérifier l'intégrité</span>
<span class="command">file /var/log/syslog</span>

<span class="comment"># Sauvegarder avant réparation</span>
<span class="command">sudo cp /var/log/syslog /var/log/syslog.backup</span>

<span class="comment"># Filtrer les caractères non-printables</span>
<span class="command">sudo strings /var/log/syslog > /tmp/syslog.clean</span>
<span class="command">sudo mv /tmp/syslog.clean /var/log/syslog</span>
                    </div>
                </div>
                
                <div class="exercise">
                    <h4>🔧 Exercices pratiques</h4>
                    <ol>
                        <li><strong>Analyse basique :</strong>
                            <ul>
                                <li>Trouvez toutes les tentatives de connexion SSH échouées dans les logs</li>
                                <li>Comptez le nombre d'erreurs par heure dans /var/log/syslog</li>
                                <li>Identifiez les 10 adresses IP les plus actives</li>
                            </ul>
                        </li>
                        <li><strong>Configuration :</strong>
                            <ul>
                                <li>Créez une règle rsyslog pour séparer les logs d'une application</li>
                                <li>Configurez logrotate pour conserver 60 jours de logs</li>
                                <li>Mettez en place un script d'alerte automatique</li>
                            </ul>
                        </li>
                        <li><strong>Monitoring :</strong>
                            <ul>
                                <li>Surveillez les logs en temps réel avec tail et grep</li>
                                <li>Créez un dashboard simple avec journalctl</li>
                                <li>Implémentez une rotation personnalisée</li>
                            </ul>
                        </li>
                    </ol>
                </div>
                
                <div class="section" id="bonnes-pratiques">
                    <h2>12. Bonnes pratiques et recommandations</h2>
                    
                    <h3>Standards de logging</h3>
                    <div class="alert alert-success">
                        <strong>Règles d'or :</strong><br>
                        • <strong>Horodatage précis :</strong> Utilisez NTP pour synchroniser l'heure<br>
                        • <strong>Format cohérent :</strong> Standardisez le format des messages<br>
                        • <strong>Niveaux appropriés :</strong> Utilisez les bonnes priorités<br>
                        • <strong>Rotation régulière :</strong> Évitez l'accumulation<br>
                        • <strong>Centralisation :</strong> Collectez les logs importants<br>
                        • <strong>Sauvegarde :</strong> Protégez les logs critiques
                    </div>
                    
                    <h3>Politiques de rétention</h3>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Type de log</th>
                                    <th>Rétention recommandée</th>
                                    <th>Rotation</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Logs système</td>
                                    <td>30-90 jours</td>
                                    <td>Quotidienne</td>
                                </tr>
                                <tr>
                                    <td>Logs de sécurité</td>
                                    <td>1-2 ans</td>
                                    <td>Hebdomadaire</td>
                                </tr>
                                <tr>
                                    <td>Logs d'audit</td>
                                    <td>3-7 ans</td>
                                    <td>Mensuelle</td>
                                </tr>
                                <tr>
                                    <td>Logs d'applications</td>
                                    <td>15-30 jours</td>
                                    <td>Quotidienne</td>
                                </tr>
                                <tr>
                                    <td>Logs de debug</td>
                                    <td>7-15 jours</td>
                                    <td>Quotidienne</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <h3>Sécurisation des logs</h3>
                    <div class="code-block">
<span class="comment"># Template de sécurisation</span>
<span class="command">sudo nano /etc/rsyslog.d/99-security.conf</span>
<span class="output">
# Logs de sécurité vers serveur distant
auth,authpriv.* @@secure-log-server.example.com:514

# Signature des logs critiques
$ActionQueueFileName secqueue
$ActionQueueMaxDiskSpace 1g
$ActionQueueSaveOnShutdown on
$ActionQueueType LinkedList
$ActionResumeRetryCount -1

# Isolation des logs sensibles
$template SecurePath,"/var/log/secure/%HOSTNAME%/%$YEAR%/%$MONTH%/%$DAY%/%PROGRAMNAME%.log"
auth,authpriv.* ?SecurePath
</span>
                    </div>
                </div>
                
                <div class="section" id="conclusion">
                    <h2>13. Conclusion et ressources</h2>
                    
                    <p>La gestion des logs est un pilier fondamental de l'administration système Linux. Elle permet non seulement de diagnostiquer les problèmes mais aussi de maintenir la sécurité et les performances du système.</p>
                    
                    <h3>Points clés à retenir</h3>
                    <ul>
                        <li>Les logs sont essentiels pour le dépannage et la sécurité</li>
                        <li>Rsyslog est l'outil central de gestion des logs</li>
                        <li>La rotation automatique évite la saturation des disques</li>
                        <li>Journalctl offre des capacités d'analyse avancées</li>
                        <li>La centralisation améliore la gestion à grande échelle</li>
                        <li>La sécurisation des logs est critique pour l'audit</li>
                    </ul>
                    
                    <h3>Ressources supplémentaires</h3>
                    <ul>
                        <li>Documentation officielle rsyslog : rsyslog.com</li>
                        <li>Manuel systemd-journald : man journald.conf</li>
                        <li>Guide logrotate : man logrotate</li>
                        <li>RFC 3164 : The BSD Syslog Protocol</li>
                        <li>RFC 5424 : The Syslog Protocol</li>
                    </ul>
                    
                    <div class="alert alert-info">
                        <strong>Prochaine étape :</strong> Jour 20 - Tâches planifiées (cron, at, systemd timers)
                    </div>
                </div>
            </div>
            
            <div class="sidebar">
                <h3>📋 Sommaire</h3>
                <ul>
                    <li><a href="#introduction">1. Introduction</a></li>
                    <li><a href="#structure">2. Structure des logs</a></li>
                    <li><a href="#rsyslog">3. Rsyslog</a></li>
                    <li><a href="#consultation">4. Consultation des logs</a></li>
                    <li><a href="#journalctl">5. Journalctl</a></li>
                    <li><a href="#rotation">6. Rotation des logs</a></li>
                    <li><a href="#monitoring">7. Surveillance</a></li>
                    <li><a href="#outils">8. Outils avancés</a></li>
                    <li><a href="#securite">9. Sécurité</a></li>
                    <li><a href="#performance">10. Performance</a></li>
                    <li><a href="#troubleshooting">11. Dépannage</a></li>
                    <li><a href="#bonnes-pratiques">12. Bonnes pratiques</a></li>
                    <li><a href="#conclusion">13. Conclusion</a></li>
                </ul>
                
                <h3>🔧 Commandes clés</h3>
                <ul>
                    <li><code>tail -f /var/log/syslog</code></li>
                    <li><code>journalctl -u service</code></li>
                    <li><code>grep "error" /var/log/*</code></li>
                    <li><code>logrotate -f</code></li>
                    <li><code>systemctl status rsyslog</code></li>
                </ul>
                
                <h3>📁 Fichiers importants</h3>
                <ul>
                    <li><code>/etc/rsyslog.conf</code></li>
                    <li><code>/etc/logrotate.conf</code></li>
                    <li><code>/var/log/syslog</code></li>
                    <li><code>/var/log/auth.log</code></li>
                    <li><code>/etc/systemd/journald.conf</code></li>
                </ul>
            </div>
        </div>
    </div>
</body>
</html>