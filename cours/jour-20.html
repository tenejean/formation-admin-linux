<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jour 20 - T√¢ches planifi√©es</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
            margin-bottom: 20px;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .nav {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }
        
        .nav ul {
            list-style: none;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .nav a {
            color: #667eea;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 25px;
            background: white;
            transition: all 0.3s ease;
            font-weight: 500;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .nav a:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .section {
            margin-bottom: 40px;
            padding: 30px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
            border-left: 5px solid #667eea;
        }
        
        .section h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 2em;
            position: relative;
            padding-bottom: 10px;
        }
        
        .section h2::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 50px;
            height: 3px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 2px;
        }
        
        .section h3 {
            color: #764ba2;
            margin-top: 25px;
            margin-bottom: 15px;
            font-size: 1.4em;
        }
        
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Consolas', 'Monaco', monospace;
            margin: 15px 0;
            overflow-x: auto;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border: 1px solid #4a5568;
        }
        
        .code-block .comment {
            color: #68d391;
        }
        
        .code-block .command {
            color: #63b3ed;
            font-weight: bold;
        }
        
        .warning {
            background: linear-gradient(135deg, #fed7d7, #feb2b2);
            border: 1px solid #fc8181;
            color: #742a2a;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-weight: 500;
        }
        
        .info {
            background: linear-gradient(135deg, #bee3f8, #90cdf4);
            border: 1px solid #63b3ed;
            color: #2a4365;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-weight: 500;
        }
        
        .success {
            background: linear-gradient(135deg, #c6f6d5, #9ae6b4);
            border: 1px solid #68d391;
            color: #22543d;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-weight: 500;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }
        
        th {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            font-weight: 600;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .exercise {
            background: linear-gradient(135deg, #fef5e7, #fed7aa);
            border: 2px solid #f6ad55;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }
        
        .exercise h4 {
            color: #c05621;
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        
        .footer {
            text-align: center;
            padding: 20px;
            color: #666;
            font-style: italic;
        }
        
        @media (max-width: 768px) {
            .nav ul {
                flex-direction: column;
            }
            
            .container {
                margin: 10px;
                padding: 15px;
            }
            
            .section {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üïê Jour 20 - T√¢ches planifi√©es</h1>
            <p>Formation Administration Syst√®me Linux</p>
            <p>Responsable : Jean Tene</p>
        </div>
        
        <nav class="nav">
            <ul>
                <li><a href="#introduction">Introduction</a></li>
                <li><a href="#cron">Cron</a></li>
                <li><a href="#crontab">Crontab</a></li>
                <li><a href="#at">Commande AT</a></li>
                <li><a href="#anacron">Anacron</a></li>
                <li><a href="#systemd">Systemd Timers</a></li>
                <li><a href="#exemples">Exemples pratiques</a></li>
                <li><a href="#exercices">Exercices</a></li>
            </ul>
        </nav>
        
        <div class="section" id="introduction">
            <h2>üìã Introduction aux t√¢ches planifi√©es</h2>
            
            <h3>Qu'est-ce qu'une t√¢che planifi√©e ?</h3>
            <p>Une t√¢che planifi√©e est un processus qui s'ex√©cute automatiquement √† des moments pr√©d√©finis ou selon un planning sp√©cifique, sans intervention manuelle de l'utilisateur. Sous Linux, ces t√¢ches sont essentielles pour l'automatisation de l'administration syst√®me.</p>
            
            <h3>Pourquoi utiliser des t√¢ches planifi√©es ?</h3>
            <ul>
                <li><strong>Automatisation :</strong> Ex√©cuter des scripts de maintenance automatiquement</li>
                <li><strong>Sauvegardes :</strong> Programmer des sauvegardes r√©guli√®res</li>
                <li><strong>Nettoyage :</strong> Supprimer les fichiers temporaires p√©riodiquement</li>
                <li><strong>Surveillance :</strong> V√©rifier l'√©tat du syst√®me r√©guli√®rement</li>
                <li><strong>Mises √† jour :</strong> Installer des mises √† jour de s√©curit√©</li>
                <li><strong>Rapports :</strong> G√©n√©rer des rapports p√©riodiques</li>
            </ul>
            
            <h3>Outils de planification sous Linux</h3>
            <table>
                <tr>
                    <th>Outil</th>
                    <th>Description</th>
                    <th>Usage principal</th>
                </tr>
                <tr>
                    <td><strong>Cron</strong></td>
                    <td>D√©mon de planification traditionnel</td>
                    <td>T√¢ches r√©currentes</td>
                </tr>
                <tr>
                    <td><strong>At</strong></td>
                    <td>Planification ponctuelle</td>
                    <td>T√¢ches uniques</td>
                </tr>
                <tr>
                    <td><strong>Anacron</strong></td>
                    <td>Cron pour syst√®mes non permanents</td>
                    <td>Ordinateurs portables</td>
                </tr>
                <tr>
                    <td><strong>Systemd Timers</strong></td>
                    <td>Syst√®me moderne de planification</td>
                    <td>Services systemd</td>
                </tr>
            </table>
        </div>
        
        <div class="section" id="cron">
            <h2>‚è∞ Le d√©mon Cron</h2>
            
            <h3>Pr√©sentation de Cron</h3>
            <p>Cron est le d√©mon de planification le plus utilis√© sous Linux. Il lit les fichiers de configuration (crontab) et ex√©cute les commandes aux moments sp√©cifi√©s. Le d√©mon cron fonctionne en arri√®re-plan et v√©rifie les t√¢ches √† ex√©cuter chaque minute.</p>
            
            <h3>Architecture de Cron</h3>
            <ul>
                <li><strong>crond :</strong> Le d√©mon principal qui s'ex√©cute en arri√®re-plan</li>
                <li><strong>crontab :</strong> Les fichiers de configuration contenant les t√¢ches</li>
                <li><strong>/etc/cron.d/ :</strong> R√©pertoire pour les t√¢ches syst√®me</li>
                <li><strong>/var/spool/cron/ :</strong> R√©pertoire des crontabs utilisateurs</li>
            </ul>
            
            <h3>V√©rification du service Cron</h3>
            <div class="code-block">
<span class="comment"># V√©rifier le statut du service cron</span>
<span class="command">systemctl status cron</span>
<span class="comment"># ou sur certaines distributions</span>
<span class="command">systemctl status crond</span>

<span class="comment"># D√©marrer le service cron</span>
<span class="command">sudo systemctl start cron</span>

<span class="comment"># Activer le service au d√©marrage</span>
<span class="command">sudo systemctl enable cron</span>
            </div>
            
            <div class="info">
                <strong>üí° Astuce :</strong> Le service cron est g√©n√©ralement d√©marr√© automatiquement au boot du syst√®me sur la plupart des distributions Linux.
            </div>
        </div>
        
        <div class="section" id="crontab">
            <h2>üìù Crontab - Configuration des t√¢ches</h2>
            
            <h3>Syntaxe de Crontab</h3>
            <p>Chaque ligne d'un fichier crontab suit cette syntaxe :</p>
            <div class="code-block">
<span class="comment"># Format : minute heure jour mois jour_semaine commande</span>
*  *  *  *  *  commande_√†_ex√©cuter
‚îÇ  ‚îÇ  ‚îÇ  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ Jour de la semaine (0-7, 0 et 7 = dimanche)
‚îÇ  ‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Mois (1-12)
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Jour du mois (1-31)
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Heure (0-23)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Minute (0-59)
            </div>
            
            <h3>Caract√®res sp√©ciaux</h3>
            <table>
                <tr>
                    <th>Caract√®re</th>
                    <th>Signification</th>
                    <th>Exemple</th>
                </tr>
                <tr>
                    <td>*</td>
                    <td>Toutes les valeurs</td>
                    <td>* = chaque minute/heure/jour</td>
                </tr>
                <tr>
                    <td>,</td>
                    <td>S√©parateur de valeurs</td>
                    <td>1,3,5 = aux minutes 1, 3 et 5</td>
                </tr>
                <tr>
                    <td>-</td>
                    <td>Plage de valeurs</td>
                    <td>1-5 = de 1 √† 5</td>
                </tr>
                <tr>
                    <td>/</td>
                    <td>Pas d'incr√©mentation</td>
                    <td>*/5 = toutes les 5 unit√©s</td>
                </tr>
                <tr>
                    <td>@reboot</td>
                    <td>Au d√©marrage</td>
                    <td>@reboot commande</td>
                </tr>
            </table>
            
            <h3>Raccourcis temporels</h3>
            <div class="code-block">
<span class="comment"># Raccourcis pratiques</span>
@yearly   = 0 0 1 1 *    <span class="comment"># Une fois par an</span>
@annually = 0 0 1 1 *    <span class="comment"># Une fois par an</span>
@monthly  = 0 0 1 * *    <span class="comment"># Une fois par mois</span>
@weekly   = 0 0 * * 0    <span class="comment"># Une fois par semaine</span>
@daily    = 0 0 * * *    <span class="comment"># Une fois par jour</span>
@hourly   = 0 * * * *    <span class="comment"># Une fois par heure</span>
@reboot                  <span class="comment"># Au d√©marrage du syst√®me</span>
            </div>
            
            <h3>Gestion des crontabs utilisateur</h3>
            <div class="code-block">
<span class="comment"># √âditer le crontab de l'utilisateur actuel</span>
<span class="command">crontab -e</span>

<span class="comment"># Lister les t√¢ches cron de l'utilisateur</span>
<span class="command">crontab -l</span>

<span class="comment"># Supprimer toutes les t√¢ches cron de l'utilisateur</span>
<span class="command">crontab -r</span>

<span class="comment"># √âditer le crontab d'un autre utilisateur (root seulement)</span>
<span class="command">sudo crontab -e -u nomutilisateur</span>

<span class="comment"># Lister les t√¢ches d'un autre utilisateur</span>
<span class="command">sudo crontab -l -u nomutilisateur</span>
            </div>
            
            <h3>Exemples de t√¢ches cron</h3>
            <div class="code-block">
<span class="comment"># Ex√©cuter un script toutes les 5 minutes</span>
*/5 * * * * /home/user/script.sh

<span class="comment"># Sauvegarde quotidienne √† 2h30 du matin</span>
30 2 * * * /usr/local/bin/backup.sh

<span class="comment"># Nettoyage hebdomadaire le dimanche √† minuit</span>
0 0 * * 0 /usr/local/bin/cleanup.sh

<span class="comment"># Rapport mensuel le 1er de chaque mois √† 9h</span>
0 9 1 * * /usr/local/bin/monthly_report.sh

<span class="comment"># Red√©marrage automatique chaque lundi √† 3h</span>
0 3 * * 1 /sbin/reboot

<span class="comment"># Ex√©cution uniquement en semaine √† 8h</span>
0 8 * * 1-5 /usr/local/bin/workday_task.sh
            </div>
            
            <div class="warning">
                <strong>‚ö†Ô∏è Attention :</strong> Les t√¢ches cron s'ex√©cutent avec un environnement minimal. Sp√©cifiez toujours les chemins complets vers les commandes et fichiers.
            </div>
        </div>
        
        <div class="section" id="at">
            <h2>üéØ Commande AT - Planification ponctuelle</h2>
            
            <h3>Pr√©sentation de AT</h3>
            <p>La commande <code>at</code> permet de planifier l'ex√©cution d'une ou plusieurs commandes √† un moment pr√©cis dans le futur. Contrairement √† cron, at est con√ßu pour des t√¢ches uniques, non r√©currentes.</p>
            
            <h3>Installation d'AT</h3>
            <div class="code-block">
<span class="comment"># Installation sur Ubuntu/Debian</span>
<span class="command">sudo apt update && sudo apt install at</span>

<span class="comment"># Installation sur CentOS/RHEL</span>
<span class="command">sudo yum install at</span>
<span class="comment"># ou sur les versions r√©centes</span>
<span class="command">sudo dnf install at</span>

<span class="comment"># D√©marrer et activer le service atd</span>
<span class="command">sudo systemctl start atd</span>
<span class="command">sudo systemctl enable atd</span>
            </div>
            
            <h3>Utilisation de base</h3>
            <div class="code-block">
<span class="comment"># Planifier une t√¢che simple</span>
<span class="command">at 15:30</span>
at> echo "T√¢che ex√©cut√©e √† 15h30" > /tmp/at_test.txt
at> <span class="comment"># Appuyer sur Ctrl+D pour terminer</span>

<span class="comment"># Planifier avec un fichier de commandes</span>
<span class="command">at 20:00 < script.sh</span>

<span class="comment"># Planifier avec l'option -f</span>
<span class="command">at -f /path/to/script.sh 22:00</span>
            </div>
            
            <h3>Formats de temps accept√©s</h3>
            <div class="code-block">
<span class="comment"># Formats d'heure</span>
<span class="command">at 14:30</span>                    <span class="comment"># Aujourd'hui √† 14h30</span>
<span class="command">at 2:30pm</span>                   <span class="comment"># Format AM/PM</span>
<span class="command">at now + 1 hour</span>             <span class="comment"># Dans 1 heure</span>
<span class="command">at now + 30 minutes</span>         <span class="comment"># Dans 30 minutes</span>
<span class="command">at now + 2 days</span>             <span class="comment"># Dans 2 jours</span>
<span class="command">at 14:30 tomorrow</span>           <span class="comment"># Demain √† 14h30</span>
<span class="command">at 14:30 next monday</span>        <span class="comment"># Lundi prochain √† 14h30</span>
<span class="command">at 14:30 2024-03-15</span>        <span class="comment"># Date sp√©cifique</span>
            </div>
            
            <h3>Gestion des t√¢ches AT</h3>
            <div class="code-block">
<span class="comment"># Lister les t√¢ches en attente</span>
<span class="command">atq</span>
<span class="comment"># ou</span>
<span class="command">at -l</span>

<span class="comment"># Supprimer une t√¢che (remplacer N par le num√©ro de t√¢che)</span>
<span class="command">atrm N</span>
<span class="comment"># ou</span>
<span class="command">at -r N</span>

<span class="comment"># Voir le contenu d'une t√¢che</span>
<span class="command">at -c N</span>
            </div>
            
            <h3>Contr√¥le d'acc√®s</h3>
            <div class="code-block">
<span class="comment"># Fichiers de contr√¥le d'acc√®s</span>
/etc/at.allow    <span class="comment"># Utilisateurs autoris√©s</span>
/etc/at.deny     <span class="comment"># Utilisateurs interdits</span>

<span class="comment"># Si at.allow existe, seuls les utilisateurs list√©s peuvent utiliser at</span>
<span class="comment"># Si seul at.deny existe, tous sauf ceux list√©s peuvent utiliser at</span>
<span class="command">sudo echo "user1" >> /etc/at.allow</span>
            </div>
            
            <div class="info">
                <strong>üí° Bon √† savoir :</strong> Les t√¢ches AT sont stock√©es dans /var/spool/at/ et sont automatiquement supprim√©es apr√®s ex√©cution.
            </div>
        </div>
        
        <div class="section" id="anacron">
            <h2>üîÑ Anacron - Cron pour syst√®mes non permanents</h2>
            
            <h3>Qu'est-ce qu'Anacron ?</h3>
            <p>Anacron est un d√©mon de planification con√ßu pour les syst√®mes qui ne fonctionnent pas 24h/24. Il ex√©cute les t√¢ches manqu√©es lorsque le syst√®me est red√©marr√©, ce qui est particuli√®rement utile pour les ordinateurs portables ou les postes de travail.</p>
            
            <h3>Diff√©rences avec Cron</h3>
            <table>
                <tr>
                    <th>Aspect</th>
                    <th>Cron</th>
                    <th>Anacron</th>
                </tr>
                <tr>
                    <td>Pr√©cision</td>
                    <td>√Ä la minute pr√®s</td>
                    <td>√Ä la journ√©e pr√®s</td>
                </tr>
                <tr>
                    <td>Syst√®me √©teint</td>
                    <td>T√¢ches manqu√©es</td>
                    <td>Rattrapage au d√©marrage</td>
                </tr>
                <tr>
                    <td>Usage</td>
                    <td>Serveurs permanents</td>
                    <td>Postes de travail</td>
                </tr>
            </table>
            
            <h3>Configuration d'Anacron</h3>
            <p>Le fichier principal de configuration est <code>/etc/anacrontab</code> :</p>
            <div class="code-block">
<span class="comment"># Format : p√©riode d√©lai identificateur commande</span>
<span class="comment"># /etc/anacrontab</span>
SHELL=/bin/sh
PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin

<span class="comment"># T√¢ches quotidiennes</span>
1       5       cron.daily      nice run-parts /etc/cron.daily
<span class="comment"># T√¢ches hebdomadaires</span>
7       25      cron.weekly     nice run-parts /etc/cron.weekly
<span class="comment"># T√¢ches mensuelles</span>
@monthly 45     cron.monthly    nice run-parts /etc/cron.monthly
            </div>
            
            <h3>Syntaxe d'Anacron</h3>
            <ul>
                <li><strong>P√©riode :</strong> Nombre de jours entre les ex√©cutions</li>
                <li><strong>D√©lai :</strong> Minutes d'attente avant l'ex√©cution</li>
                <li><strong>Identificateur :</strong> Nom unique pour la t√¢che</li>
                <li><strong>Commande :</strong> Commande √† ex√©cuter</li>
            </ul>
            
            <h3>Commandes Anacron</h3>
            <div class="code-block">
<span class="comment"># Ex√©cuter toutes les t√¢ches anacron maintenant</span>
<span class="command">sudo anacron -f</span>

<span class="comment"># Tester la configuration</span>
<span class="command">sudo anacron -T</span>

<span class="comment"># Ex√©cuter en mode debug</span>
<span class="command">sudo anacron -d</span>

<span class="comment"># Forcer l'ex√©cution d'une t√¢che sp√©cifique</span>
<span class="command">sudo anacron -f cron.daily</span>
            </div>
        </div>
        
        <div class="section" id="systemd">
            <h2>‚öôÔ∏è Systemd Timers - Planification moderne</h2>
            
            <h3>Introduction aux Systemd Timers</h3>
            <p>Les timers systemd constituent une alternative moderne √† cron, offrant plus de flexibilit√© et une meilleure int√©gration avec le syst√®me. Ils permettent de d√©clencher des services systemd selon des plannings d√©finis.</p>
            
            <h3>Avantages des Systemd Timers</h3>
            <ul>
                <li><strong>Logs centralis√©s :</strong> Int√©gration avec journald</li>
                <li><strong>Gestion des d√©pendances :</strong> D√©marrage conditionnel</li>
                <li><strong>Flexibilit√© :</strong> D√©clenchement sur √©v√©nements syst√®me</li>
                <li><strong>Monitoring :</strong> Surveillance avec systemctl</li>
            </ul>
            
            <h3>Cr√©ation d'un timer systemd</h3>
            <p>Un timer systemd n√©cessite deux fichiers :</p>
            
            <h4>1. Fichier service (.service)</h4>
            <div class="code-block">
<span class="comment"># /etc/systemd/system/backup.service</span>
[Unit]
Description=Backup Service
Wants=backup.timer

[Service]
Type=oneshot
ExecStart=/usr/local/bin/backup.sh

[Install]
WantedBy=multi-user.target
            </div>
            
            <h4>2. Fichier timer (.timer)</h4>
            <div class="code-block">
<span class="comment"># /etc/systemd/system/backup.timer</span>
[Unit]
Description=Backup Timer
Requires=backup.service

[Timer]
OnCalendar=daily
Persistent=true

[Install]
WantedBy=timers.target
            </div>
            
            <h3>Syntaxe OnCalendar</h3>
            <div class="code-block">
<span class="comment"># Exemples de syntaxe OnCalendar</span>
OnCalendar=*-*-* 02:00:00    <span class="comment"># Tous les jours √† 2h</span>
OnCalendar=Mon *-*-* 02:00:00 <span class="comment"># Tous les lundis √† 2h</span>
OnCalendar=weekly            <span class="comment"># Chaque semaine</span>
OnCalendar=monthly           <span class="comment"># Chaque mois</span>
OnCalendar=*-*-01 03:00:00   <span class="comment"># Le 1er de chaque mois √† 3h</span>
OnCalendar=*:0/15            <span class="comment"># Toutes les 15 minutes</span>
            </div>
            
            <h3>Gestion des timers</h3>
            <div class="code-block">
<span class="comment"># Recharger la configuration systemd</span>
<span class="command">sudo systemctl daemon-reload</span>

<span class="comment"># Activer et d√©marrer le timer</span>
<span class="command">sudo systemctl enable backup.timer</span>
<span class="command">sudo systemctl start backup.timer</span>

<span class="comment"># V√©rifier le statut du timer</span>
<span class="command">systemctl status backup.timer</span>

<span class="comment"># Lister tous les timers actifs</span>
<span class="command">systemctl list-timers</span>

<span class="comment"># Voir les logs du service</span>
<span class="command">journalctl -u backup.service</span>
            </div>
            
            <h3>Options avanc√©es des timers</h3>
            <div class="code-block">
<span class="comment"># Fichier timer avec options avanc√©es</span>
[Timer]
OnCalendar=daily
OnBootSec=15min          <span class="comment"># 15 min apr√®s le boot</span>
OnUnitActiveSec=1h       <span class="comment"># 1h apr√®s la derni√®re activation</span>
Persistent=true          <span class="comment"># Rattraper les ex√©cutions manqu√©es</span>
AccuracySec=1min         <span class="comment"># Pr√©cision temporelle</span>
RandomizedDelaySec=300   <span class="comment"># D√©lai al√©atoire jusqu'√† 5 min</span>
            </div>
        </div>
        
        <div class="section" id="exemples">
            <h2>üîß Exemples pratiques</h2>
            
            <h3>Exemple 1 : Sauvegarde automatique</h3>
            <div class="code-block">
<span class="comment"># Script de sauvegarde : /usr/local/bin/backup.sh</span>
#!/bin/bash
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="/backup"
SOURCE_DIR="/home"
LOG_FILE="/var/log/backup.log"

echo "$(date): D√©but de la sauvegarde" >> $LOG_FILE
tar -czf $BACKUP_DIR/backup_$DATE.tar.gz $SOURCE_DIR
if [ $? -eq 0 ]; then
    echo "$(date): Sauvegarde r√©ussie" >> $LOG_FILE
else
    echo "$(date): Erreur lors de la sauvegarde" >> $LOG_FILE
fi

<span class="comment"># Crontab pour ex√©cution quotidienne √† 2h</span>
0 2 * * * /usr/local/bin/backup.sh
            </div>
            
            <h3>Exemple 2 : Nettoyage des logs</h3>
            <div class="code-block">
<span class="comment"># Script de nettoyage : /usr/local/bin/cleanup_logs.sh</span>
#!/bin/bash
LOG_DIRS="/var/log /tmp"
DAYS_OLD=30

for DIR in $LOG_DIRS; do
    find $DIR -name "*.log" -type f -mtime +$DAYS_OLD -delete
    find $DIR -name "*.tmp" -type f -mtime +7 -delete
done

<span class="comment"># Crontab pour ex√©cution hebdomadaire</span>
0 3 * * 0 /usr/local/bin/cleanup_logs.sh
            </div>
            
            <h3>Exemple 3 : Surveillance syst√®me</h3>
            <div class="code-block">
<span class="comment"># Script de surveillance : /usr/local/bin/system_check.sh</span>
#!/bin/bash
EMAIL="admin@example.com"
HOSTNAME=$(hostname)

<span class="comment"># V√©rifier l'espace disque</span>
DISK_USAGE=$(df -h / | awk 'NR==2 {print $5}' | cut -d'%' -f1)
if [ $DISK_USAGE -gt 90 ]; then
    echo "ALERTE: Espace disque critique sur $HOSTNAME ($DISK_USAGE%)" | \
    mail -s "Alerte espace disque" $EMAIL
fi

<span class="comment"># V√©rifier la charge syst√®me</span>
LOAD=$(uptime | awk -F'load average:' '{print $2}' | awk '{print $1}' | cut -d',' -f1)
if [ $(echo "$LOAD > 5.0" | bc) -eq 1 ]; then
    echo "ALERTE: Charge syst√®me √©lev√©e sur $HOSTNAME ($LOAD)" | \
    mail -s "Alerte charge syst√®me" $EMAIL
fi

<span class="comment"># Crontab pour v√©rification toutes les 15 minutes</span>
*/15 * * * * /usr/local/bin/system_check.sh
            </div>
            
            <h3>Exemple 4 : Mise √† jour automatique</h3>
            <div class="code-block">
<span class="comment"># Script de mise √† jour : /usr/local/bin/auto_update.sh</span>
#!/bin/bash
LOG_FILE="/var/log/auto_update.log"

echo "$(date): D√©but des mises √† jour" >> $LOG_FILE

<span class="comment"># Pour Ubuntu/Debian</span>
if command -v apt &> /dev/null; then
    apt update >> $LOG_FILE 2>&1
    apt upgrade -y >> $LOG_FILE 2>&1
fi

<span class="comment"># Pour CentOS/RHEL</span>
if command -v yum &> /dev/null; then
    yum update -y >> $LOG_FILE 2>&1
fi

echo "$(date): Fin des mises √† jour" >> $LOG_FILE

<span class="comment"># Crontab pour ex√©cution mensuelle</span>
0 4 1 * * /usr/local/bin/auto_update.sh
            </div>
        </div>
        
        <div class="section" id="bonnes-pratiques">
            <h2>‚úÖ Bonnes pratiques et s√©curit√©</h2>
            
            <h3>Bonnes pratiques g√©n√©rales</h3>
            <ul>
                <li><strong>Chemins absolus :</strong> Utilisez toujours des chemins complets vers les commandes et fichiers</li>
                <li><strong>Variables d'environnement :</strong> D√©finissez PATH, SHELL, et autres variables n√©cessaires</li>
                <li><strong>Gestion des erreurs :</strong> Impl√©mentez une gestion d'erreur robuste dans vos scripts</li>
                <li><strong>Logging :</strong> Enregistrez les activit√©s et erreurs dans des fichiers de log</li>
                <li><strong>Tests :</strong> Testez vos scripts manuellement avant de les automatiser</li>
            </ul>
            
            <h3>S√©curit√© des t√¢ches planifi√©es</h3>
            <div class="code-block">
<span class="comment"># Variables d'environnement s√©curis√©es dans crontab</span>
PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin
SHELL=/bin/bash
MAILTO=admin@example.com

<span class="comment"># Exemple de crontab s√©curis√©</span>
0 2 * * * /usr/local/bin/backup.sh > /var/log/backup.log 2>&1
            </div>
            
            <h3>Gestion des permissions</h3>
            <div class="code-block">
<span class="comment"># Permissions appropri√©es pour les scripts</span>
<span class="command">chmod 750 /usr/local/bin/backup.sh</span>
<span class="command">chown root:root /usr/local/bin/backup.sh</span>

<span class="comment"># S√©curisation des fichiers crontab</span>
<span class="command">chmod 600 /var/spool/cron/crontabs/*</span>
            </div>
            
            <h3>Surveillance et debugging</h3>
            <div class="code-block">
<span class="comment"># V√©rifier les logs syst√®me pour les t√¢ches cron</span>
<span class="command">grep CRON /var/log/syslog</span>
<span class="command">grep CRON /var/log/messages</span>

<span class="comment"># Activer le logging d√©taill√© de cron</span>
<span class="command">sudo vim /etc/rsyslog.conf</span>
<span class="comment"># D√©commenter : cron.*    /var/log/cron.log</span>
<span class="command">sudo systemctl restart rsyslog</span>

<span class="comment"># V√©rifier l'ex√©cution des t√¢ches AT</span>
<span class="command">sudo cat /var/log/syslog | grep atd</span>
            </div>
            
            <div class="warning">
                <strong>‚ö†Ô∏è S√©curit√© :</strong> Ne jamais stocker de mots de passe ou d'informations sensibles en clair dans les t√¢ches planifi√©es. Utilisez des fichiers de configuration s√©curis√©s ou des variables d'environnement.
            </div>
        </div>
        
        <div class="section" id="exercices">
            <h2>üìö Exercices pratiques</h2>
            
            <div class="exercise">
                <h4>Exercice 1 : Cr√©ation d'une t√¢che cron basique</h4>
                <p><strong>Objectif :</strong> Cr√©er une t√¢che qui affiche la date et l'heure dans un fichier toutes les minutes.</p>
                <p><strong>Instructions :</strong></p>
                <ol>
                    <li>Ouvrez votre crontab avec <code>crontab -e</code></li>
                    <li>Ajoutez une ligne pour ex√©cuter <code>date >> /tmp/cron_test.txt</code> chaque minute</li>
                    <li>Attendez quelques minutes et v√©rifiez le contenu du fichier</li>
                    <li>Supprimez la t√¢che une fois le test termin√©</li>
                </ol>
            </div>
            
            <div class="exercise">
                <h4>Exercice 2 : Script de sauvegarde programm√©</h4>
                <p><strong>Objectif :</strong> Cr√©er un script de sauvegarde et le programmer pour s'ex√©cuter quotidiennement.</p>
                <p><strong>Instructions :</strong></p>
                <ol>
                    <li>Cr√©ez un script <code>/usr/local/bin/my_backup.sh</code> qui sauvegarde votre r√©pertoire home</li>
                    <li>Rendez le script ex√©cutable</li>
                    <li>Programmez-le pour s'ex√©cuter tous les jours √† 3h du matin</li>
                    <li>Testez manuellement le script avant de l'automatiser</li>
                </ol>
            </div>
            
            <div class="exercise">
                <h4>Exercice 3 : Utilisation de la commande AT</h4>
                <p><strong>Objectif :</strong> Programmer une t√¢che ponctuelle avec AT.</p>
                <p><strong>Instructions :</strong></p>
                <ol>
                    <li>Utilisez <code>at</code> pour programmer l'arr√™t du syst√®me dans 30 minutes</li>
                    <li>Listez les t√¢ches en attente avec <code>atq</code></li>
                    <li>Annulez la t√¢che avant qu'elle ne s'ex√©cute avec <code>atrm</code></li>
                    <li>Cr√©ez une t√¢che qui red√©marre un service dans 5 minutes</li>
                </ol>
            </div>
            
            <div class="exercise">
                <h4>Exercice 4 : Cr√©ation d'un timer systemd</h4>
                <p><strong>Objectif :</strong> Cr√©er un timer systemd pour une t√¢che de maintenance.</p>
                <p><strong>Instructions :</strong></p>
                <ol>
                    <li>Cr√©ez un service systemd qui nettoie les fichiers temporaires</li>
                    <li>Cr√©ez un timer associ√© qui s'ex√©cute quotidiennement</li>
                    <li>Activez et d√©marrez le timer</li>
                    <li>V√©rifiez son fonctionnement avec <code>systemctl list-timers</code></li>
                </ol>
            </div>
            
            <div class="exercise">
                <h4>Exercice 5 : Surveillance syst√®me automatis√©e</h4>
                <p><strong>Objectif :</strong> Cr√©er un script de surveillance qui envoie des alertes.</p>
                <p><strong>Instructions :</strong></p>
                <ol>
                    <li>Cr√©ez un script qui v√©rifie l'espace disque, la m√©moire et la charge CPU</li>
                    <li>Le script doit envoyer une alerte (mail ou log) si les seuils sont d√©pass√©s</li>
                    <li>Programmez le script pour s'ex√©cuter toutes les 10 minutes</li>
                    <li>Testez les alertes en simulant une charge √©lev√©e</li>
                </ol>
            </div>
        </div>
        
        <div class="section" id="depannage">
            <h2>üîç D√©pannage et r√©solution de probl√®mes</h2>
            
            <h3>Probl√®mes courants avec Cron</h3>
            <table>
                <tr>
                    <th>Probl√®me</th>
                    <th>Cause probable</th>
                    <th>Solution</th>
                </tr>
                <tr>
                    <td>T√¢che ne s'ex√©cute pas</td>
                    <td>Syntaxe incorrecte</td>
                    <td>V√©rifier la syntaxe crontab</td>
                </tr>
                <tr>
                    <td>Commande introuvable</td>
                    <td>PATH incomplet</td>
                    <td>Utiliser les chemins absolus</td>
                </tr>
                <tr>
                    <td>Permissions refus√©es</td>
                    <td>Script non ex√©cutable</td>
                    <td>chmod +x sur le script</td>
                </tr>
                <tr>
                    <td>Variables manquantes</td>
                    <td>Environnement minimal</td>
                    <td>D√©finir les variables dans crontab</td>
                </tr>
            </table>
            
            <h3>Outils de diagnostic</h3>
            <div class="code-block">
<span class="comment"># V√©rifier si cron fonctionne</span>
<span class="command">ps aux | grep cron</span>
<span class="command">systemctl status cron</span>

<span class="comment"># V√©rifier la syntaxe crontab</span>
<span class="command">crontab -l</span>

<span class="comment"># Tester un script manuellement</span>
<span class="command">sudo -u username /path/to/script.sh</span>

<span class="comment"># V√©rifier les logs d'ex√©cution</span>
<span class="command">tail -f /var/log/syslog | grep CRON</span>
            </div>
            
            <h3>Conseils de d√©pannage</h3>
            <ul>
                <li>Testez toujours vos scripts manuellement avant de les automatiser</li>
                <li>Utilisez des redirections pour capturer les erreurs : <code>command > /dev/null 2>&1</code></li>
                <li>D√©finissez MAILTO pour recevoir les erreurs par email</li>
                <li>Utilisez <code>set -e</code> dans vos scripts pour arr√™ter en cas d'erreur</li>
                <li>Loggez les activit√©s de vos scripts pour faciliter le debugging</li>
            </ul>
        </div>
        
        <div class="section" id="resume">
            <h2>üìã R√©sum√© du cours</h2>
            
            <h3>Points cl√©s √† retenir</h3>
            <ul>
                <li><strong>Cron</strong> est l'outil principal pour les t√¢ches r√©currentes sous Linux</li>
                <li><strong>AT</strong> permet de programmer des t√¢ches ponctuelles</li>
                <li><strong>Anacron</strong> rattrape les t√¢ches manqu√©es sur les syst√®mes non permanents</li>
                <li><strong>Systemd timers</strong> offrent une alternative moderne avec plus de fonctionnalit√©s</li>
                <li>La s√©curit√© et les bonnes pratiques sont essentielles pour √©viter les probl√®mes</li>
            </ul>
            
            <h3>Commandes essentielles</h3>
            <div class="code-block">
<span class="comment"># Gestion crontab</span>
<span class="command">crontab -e</span>      <span class="comment"># √âditer</span>
<span class="command">crontab -l</span>      <span class="comment"># Lister</span>
<span class="command">crontab -r</span>      <span class="comment"># Supprimer</span>

<span class="comment"># Commande AT</span>
<span class="command">at time</span>         <span class="comment"># Programmer</span>
<span class="command">atq</span>             <span class="comment"># Lister</span>
<span class="command">atrm N</span>          <span class="comment"># Supprimer</span>

<span class="comment"># Systemd timers</span>
<span class="command">systemctl list-timers</span>   <span class="comment"># Lister</span>
<span class="command">systemctl status timer</span>  <span class="comment"># Statut</span>
            </div>
            
            <h3>Prochaines √©tapes</h3>
            <p>Dans le prochain cours, nous aborderons la <strong>gestion des logs</strong> sous Linux, un sujet √©troitement li√© aux t√¢ches planifi√©es pour la surveillance et la maintenance du syst√®me.</p>
        </div>
        
        <div class="footer">
            <p>Formation Administration Syst√®me Linux - Jour 20 - T√¢ches planifi√©es</p>
            <p>Responsable : Jean Tene | ¬© 2025</p>
        </div>
    </div>
</body>
</html>